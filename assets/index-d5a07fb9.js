(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function Le(e){let t=0;for(var n=0;n<e.length;n++)e[n]!=0&&(t=t+(1<<n));return t}function Be(e,t){const n=e.length,a=new Array(n).fill(0).map(()=>new Array(n));let o=[];for(var i=0;i<e.length;i++)o[i]=Le(e[i]);for(let p=0;p<n;p++){var r=e[p];for(let w=0;w<n;w++){var s=0,l=o[p]&o[w];if(l)for(var c=t[w];l;){var d=31-Math.clz32(l);l=l-(1<<d),s+=r[d]*c[d]}a[p][w]=s}}return a}function ge(e,t){const n=e.length,a=e[0].length,o=new Array(n).fill(0).map(()=>new Array(a));for(let i=0;i<n;i++){let r=o[i],s=e[i];for(let l=0;l<a;l++)r[l]=s[l]/t[l]}return o}function L(e,t){return[e[0]-t[0],e[1]-t[1]]}function Ae(e,t){return new Array(e.length).fill(0).map((n,a)=>e[a]-t[a])}function je(e,t){const n=e.length,a=e[0].length,o=t.length,i=t[0].length;a!=o&&(console.log(a),console.log(o),assert(a==o));const r=new Array(n).fill(0).map(()=>new Array(i).fill(0));for(let s=0;s<n;s++)for(let l=0;l<i;l++)for(let c=0;c<a;c++)r[s][l]+=e[s][c]*t[c][l];return r}function Oe(e,t){const n=e.length;for(let r=0;r<n;r++){let s=Math.abs(e[r][r]),l=r;for(let p=r+1;p<n;p++)Math.abs(e[p][r])>s&&(s=Math.abs(e[p][r]),l=p);const c=e[l];e[l]=e[r],e[r]=c;const d=t[l];t[l]=t[r],t[r]=d;var a=e[r];for(let p=r+1;p<n;p++){var o=e[p];const w=-o[r]/a[r];o[r]=0;for(let m=r+1;m<n;m++)o[m]+=w*a[m];t[p]+=w*t[r]}}const i=new Array(n).fill(0);for(let r=n-1;r>-1;r--){i[r]=t[r]/e[r][r];for(let s=r-1;s>-1;s--)t[s]-=e[s][r]*i[r]}return i}function Ne(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(Math.abs(e[n]),t);return t}function xe(e,t){for(var n=new Array(e.length),a=0;a<e.length;a++)n[a]=e[a]-t[a];return n}function g(e,t){for(var n=new Array(e.length),a=0;a<e.length;a++)n[a]=e[a]+t[a];return n}function v(e,t){if(Array.isArray(e)){var n=t;t=e,e=n}for(var a=new Array(t.length),o=0;o<t.length;o++)a[o]=e*t[o];return a}function we(e,t,n,a,o,i,r){this.x=e,this.y=t,this.f=n,this.ymid=a,this.iterations=o,this.events=r,this.message=i}we.prototype._at=function(y,n){function a(F){return F*F}var o=this,i=o.x,r=o.y,s=o.f,l=o.ymid;i.length;var c,d,p,w,m,x,y,$,B=.5,A,J,T;return c=i[n],d=i[n+1],w=r[n],m=r[n+1],$=d-c,p=c+B*$,x=l[n],A=xe(s[n],v(w,1/(c-p)+2/(c-d))),J=xe(s[n+1],v(m,1/(d-p)+2/(d-c))),T=[a(y-d)*(y-p)/a(c-d)/(c-p),a(y-c)*a(y-d)/a(c-p)/a(d-p),a(y-c)*(y-p)/a(d-c)/(d-p),(y-c)*a(y-d)*(y-p)/a(c-d)/(c-p),(y-d)*a(y-c)*(y-p)/a(c-d)/(d-p)],g(g(g(g(v(w,T[0]),v(x,T[1])),v(m,T[2])),v(A,T[3])),v(J,T[4]))};we.prototype.at=function(t){var n,a,o,i=Math.floor;if(typeof t!="number"){var r=t.length,s=Array(r);for(n=r-1;n!==-1;--n)s[n]=this.at(t[n]);return s}var l=this.x;for(n=0,a=l.length-1;a-n>1;)o=i(.5*(n+a)),l[o]<=t?n=o:a=o;return this._at(t,n)};function Fe(e,t,n,a,o,i,r){typeof o>"u"&&(o=1e-6),typeof i>"u"&&(i=1e3);var s=[e],l=[n],c=[a(e,n)],d,p,w,m,x,y,$=[],B=1/5,A=[3/40,9/40],J=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],F=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],U=[35/384,0,500/1113,125/192,-2187/6784,11/84],D=[.5*6025192743/30085553152,0,.5*51252292925/65400821598,.5*-2691868925/45128329728,.5*187940372067/1594534317056,.5*-1776094331/19743644256,.5*11237099/235043384],W=[1/5,3/10,4/5,8/9,1,1],Y=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],_=0,Q,j,f=(t-e)/10,V=0,R,G,ve=Math.min,Te=Math.abs,ye=Math.pow,Z=Z,z=z,ee=ee,C,I,H,S=new we(s,l,c,$,-1,"");for(typeof r=="function"&&(C=r(e,n));e<t&&V<i;){if(++V,e+f>t&&(f=t-e),d=a(e+W[0]*f,g(n,v(B*f,c[_]))),p=a(e+W[1]*f,g(g(n,v(A[0]*f,c[_])),v(A[1]*f,d))),w=a(e+W[2]*f,g(g(g(n,v(J[0]*f,c[_])),v(J[1]*f,d)),v(J[2]*f,p))),m=a(e+W[3]*f,g(g(g(g(n,v(T[0]*f,c[_])),v(T[1]*f,d)),v(T[2]*f,p)),v(T[3]*f,w))),x=a(e+W[4]*f,g(g(g(g(g(n,v(F[0]*f,c[_])),v(F[1]*f,d)),v(F[2]*f,p)),v(F[3]*f,w)),v(F[4]*f,m))),R=g(g(g(g(g(n,v(c[_],f*U[0])),v(p,f*U[2])),v(w,f*U[3])),v(m,f*U[4])),v(x,f*U[5])),y=a(e+f,R),Q=g(g(g(g(g(v(c[_],f*Y[0]),v(p,f*Y[2])),v(w,f*Y[3])),v(m,f*Y[4])),v(x,f*Y[5])),v(y,f*Y[6])),typeof Q=="number"?G=Te(Q):G=Ne(Q),G>o){if(f=.2*f*ye(o/G,.25),e+f===e){S.msg="Step size became too small";break}continue}if($[_]=g(g(g(g(g(g(n,v(c[_],f*D[0])),v(p,f*D[2])),v(w,f*D[3])),v(m,f*D[4])),v(x,f*D[5])),v(y,f*D[6])),++_,s[_]=e+f,l[_]=R,c[_]=y,typeof r=="function"){var te,K=e,O=e+.5*f,E;if(I=r(O,$[_-1]),H=ee(z(C,0),z(0,I)),Z(H)||(K=O,O=e+f,C=I,I=r(O,R),H=ee(z(C,0),z(0,I))),Z(H)){for(var le,ae,ne=0,X=1,q=1;;){if(typeof C=="number")E=(q*I*K-X*C*O)/(q*I-X*C);else for(E=O,j=C.length-1;j!==-1;--j)C[j]<0&&I[j]>0&&(E=ve(E,(q*I[j]*K-X*C[j]*O)/(q*I[j]-X*C[j])));if(E<=K||E>=O)break;te=S._at(E,_-1),ae=r(E,te),le=ee(z(C,0),z(0,ae)),Z(le)?(O=E,I=ae,H=le,q=1,ne===-1?X*=.5:X=1,ne=-1):(K=E,C=ae,X=1,ne===1?q*=.5:q=1,ne=1)}return R=S._at(.5*(e+E),_-1),S.f[_]=a(E,te),S.x[_]=E,S.y[_]=te,S.ymid[_-1]=R,S.events=H,S.iterations=V,S}}e+=f,n=R,C=I,f=ve(.8*f*ye(o/G,.25),4*f)}return S.iterations=V,S}function ue(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function de(e,t){return e[0]*t[1]-e[1]*t[0]}function h(e,t){return[e[2*t],e[2*t+1]]}function P(e,t,n){e[2*n]=t[0],e[2*n+1]=t[1]}function Re(e,t,n){this.p1=e,this.p2=t,this.oneway=n,this.name="Rod"}function ze(e,t,n){this.p1=e,this.p2=JSON.parse(JSON.stringify(t)),this.p3=n,this.name="Rope"}function Xe(e,t,n){this.reference=e,this.slide=t,this.base=n,this.fatmode=!1,this.name="F2k"}function qe(e,t,n,a){this.reference=e,this.slide=t,this.base=n,this.oneway=a,this.name="Colinear"}function ce(e,t,n){this.p=e,this.n=ue(t),this.oneway=n,this.name="Slider"}function Je(e,t,n,a){this.forces=Array(t.length).fill([0,-1]).flat(),this.constraints=e,this.masses=t.flatMap(o=>[o,o]),this.positions=n,this.velocities=a}function De(e){let t={rod:[],slider:[],colinear:[],f2k:[],rope:[],pin:[]};for(let n of e)switch(n.name){case"Rod":t.rod.push({p1:n.p1,p2:n.p2,oneway:n.oneway});break;case"Slider":t.slider.push({p:n.p,normal:{x:n.n[0],y:n.n[1]},oneway:n.oneway});break;case"Colinear":t.colinear.push({reference:n.reference,slider:n.slide,base:n.base,oneway:n.oneway});break;case"F2k":t.f2k.push({reference:n.reference,slider:n.slide,base:n.base});break;case"Rope":t.rope.push({p1:n.p1,pulleys:n.p2.filter(a=>a.wrapping!="cw_drop"&&a.wrapping!="ccw_drop"),p3:n.p3});break}return t}function be(e,t,n,a,o){var i=Date.now();let r=[],s=[],l=[];for(var c of e)r.push(c.mass),s.push(c.x),s.push(c.y);for(var d of t.rod)l.push(new Re(d.p1,d.p2,d.oneway));for(var p of t.slider)l.push(new ce(p.p,[p.normal.x,p.normal.y],p.oneway));for(var p of t.pin)l.push(new ce(p.p,[0,1],!1)),l.push(new ce(p.p,[1,0],!1));for(var w of t.colinear)l.push(new qe(w.reference,w.slider,w.base,w.oneway));for(var m of t.f2k)l.push(new Xe(m.reference,m.slider,m.base));for(var x of t.rope)l.push(new ze(x.p1,x.pulleys.slice(),x.p3));var y=new Je(l,r,s,new Array(s.length).fill(0));y.terminate=o;let $=y.positions.concat(y.velocities),B=Ye(y,$,n,a);var A=Date.now();return document.getElementById("simtime").innerText=A-i,B}function Ye(e,t,n,a){for(var o=[],i=[],r=(d,p)=>{for(;d<o[o.length-1];){o.pop();var w=i.pop();e.constraints=JSON.parse(w),e.string_constraint=w}return o.push(d),e.string_constraint=JSON.stringify(e.constraints),i.push(e.string_constraint),Ue(e,p)[0]},s=Fe(0,a,t,r,1e-4,1e4),l=[],c=0;c<a;)l.push(s.at(c)),c+=n;return[l,[o,i]]}function He(e){var t=e.constraints.map(s=>{if(s.name==="Rod")return We(s,e);if(s.name==="Slider")return Ge(s,e);if(s.name==="Colinear")return et(s,e);if(s.name==="F2k")return at(s,e);if(s.name==="Rope")return Qe(s,e)}),n=ge(t,e.masses);n=Be(n,t);var a=e.constraints.map(s=>{if(s.name==="Rod")return Ke(s,e);if(s.name==="Slider")return Ze(s,e);if(s.name==="Colinear")return tt(s,e);if(s.name==="F2k")return nt(s,e);if(s.name==="Rope")return Ve(s,e)});let o=Oe(n,a);for(var i=0;i<o.length;i++)e.constraints[i].force=o[i];let r=Ae(ge(je([o],t),e.masses)[0],e.forces);for(var i=0;i<o.length;i++)if(o[i]>0&&e.constraints[i].oneway===!0){e.constraints.splice(i,1),e.string_constraint=null;break}return[r,!1]}function Ue(e,t){e.positions=t.slice(0,e.positions.length),e.velocities=t.slice(e.positions.length,t.length);let[n,a]=He(e);if(e.terminate(t)){for(var o=window.data.projectile,i=0;i<e.constraints.length;i++)if(e.constraints[i].p1===o||e.constraints[i].p2===o||e.constraints[i].p3===o){e.constraints.splice(i,1),e.string_constraint=null;break}}return[e.velocities.concat(n),!1]}function We(e,t){let n=ue(L(h(t.positions,e.p1),h(t.positions,e.p2))),a=new Array(t.positions.length).fill(0);return P(a,n,e.p2),P(a,[-n[0],-n[1]],e.p1),a}function Ge(e,t){let n=new Array(t.positions.length).fill(0);return P(n,e.n,e.p),n}function Ke(e,t){let n=L(h(t.positions,e.p1),h(t.positions,e.p2)),a=L(h(t.velocities,e.p1),h(t.velocities,e.p2)),o=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return(a[0]*a[0]+a[1]*a[1])/o}function Qe(e,t){var n=[];n.push(e.p1);for(var a of e.p2)n.push(a.idx);n.push(e.p3);for(var o=1;o<n.length-1;o++){var i=h(t.positions,n[o-1]),r=h(t.positions,n[o]),s=h(t.positions,n[o+1]),l=de(L(i,r),L(r,s));if(l>0&&e.p2[o-1].wrapping=="ccw_drop"||l<0&&e.p2[o-1].wrapping=="cw_drop"){e.p2[o-1].wrapping="both",t.string_constraint=null;break}}n=[],n.push(e.p1);for(var a of e.p2)a.wrapping!="ccw_drop"&&a.wrapping!="cw_drop"&&n.push(a.idx);n.push(e.p3);for(var o=1;o<n.length-1;o++){var i=h(t.positions,n[o-1]),r=h(t.positions,n[o]),s=h(t.positions,n[o+1]),l=de(L(i,r),L(r,s));if(l>0&&e.p2[o-1].wrapping=="ccw"||l<0&&e.p2[o-1].wrapping=="cw"){e.p2.splice(o-1,1),t.string_constraint=null;break}}n=[],n.push(e.p1);for(var a of e.p2)a.wrapping!="ccw_drop"&&a.wrapping!="cw_drop"&&n.push(a.idx);n.push(e.p3);let c=new Array(t.positions.length).fill(0);for(var o=0;o<n.length-1;o++){let p=n[o],w=n[o+1],m=ue(L(h(t.positions,p),h(t.positions,w))),x=h(c,p);P(c,L(x,m),p),P(c,m,w)}return c}function Ve(e,t){var n=0,a=[];a.push(e.p1);for(var o of e.p2)o.wrapping!="ccw_drop"&&o.wrapping!="cw_drop"&&a.push(o.idx);a.push(e.p3);for(var i=0;i<a.length-1;i++){let r=a[i],s=a[i+1],l=L(h(t.positions,r),h(t.positions,s)),c=L(h(t.velocities,r),h(t.velocities,s)),d=Math.sqrt(l[0]*l[0]+l[1]*l[1]);n+=Math.pow(de(l,c),2)/(d*d*d)}return n}function Ze(e,t){var n=h(t.forces,e.p);return e.n[0]*n[0]+e.n[1]*n[1]}function et(e,t){var[n,a]=h(t.positions,e.slide);h(t.velocities,e.slide);var[o,i]=h(t.positions,e.reference);h(t.velocities,e.reference);var[r,s]=h(t.positions,e.base);h(t.velocities,e.base),n=n-r,a=a-s,o=o-r,i=i-s;var l=Math.sqrt(o*o+i*i),c=l*l*l,d=-i/l,p=o/l,w=(n*o*i+a*i*i)/c,m=-(n*o*o+o*a*i)/c,x=-d-w,y=-p-m;let $=new Array(t.positions.length).fill(0);return P($,[d,p],e.slide),P($,[w,m],e.reference),P($,[x,y],e.base),$}function tt(e,t){var[n,a]=h(t.positions,e.slide),[o,i]=h(t.velocities,e.slide),[r,s]=h(t.positions,e.reference),[l,c]=h(t.velocities,e.reference),[d,p]=h(t.positions,e.base),[w,m]=h(t.velocities,e.base);n=n-d,a=a-p,o=o-w,i=i-m,r=r-d,s=s-p,l=l-w,c=c-m;var x=Math.sqrt(r*r+s*s),y=r/x,$=s/x,B=(c*y-l*$)*(((2*l*n-c*a)*y*y+(c*n+l*a)*3*y*$+(2*c*a-l*n)*$*$)/(x*x)-2*(o*y+i*$)/x);return-B}function at(e,t){var[n,a]=h(t.positions,e.slide);h(t.velocities,e.slide);var[o,i]=h(t.positions,e.reference);h(t.velocities,e.reference);var[r,s]=h(t.positions,e.base);h(t.velocities,e.base),n=n-r,a=a-s,o=o-r,i=i-s;let l=new Array(t.positions.length).fill(0);if(i<0){if(!e.fatmode){var c=n,d=o-n;e.ratio=c/d}e.fatmode=!0,t.string_constraint=null}if(e.fatmode)return P(l,[0,1],e.base),P(l,[0,e.ratio],e.reference),l;var p=Math.sqrt(o*o+i*i),w=p*p*p,m=-i/p,x=o/p,y=(n*o*i+a*i*i)/w,$=-(n*o*o+o*a*i)/w,B=-m-y,A=-x-$;return P(l,[m,x],e.slide),P(l,[y,$],e.reference),P(l,[B,A],e.base),l}function nt(e,t){if(e.fatmode)return-1-e.ratio;var[n,a]=h(t.positions,e.slide),[o,i]=h(t.velocities,e.slide),[r,s]=h(t.positions,e.reference),[l,c]=h(t.velocities,e.reference),[d,p]=h(t.positions,e.base),[w,m]=h(t.velocities,e.base);n=n-d,a=a-p,o=o-w,i=i-m,r=r-d,s=s-p,l=l-w,c=c-m;var x=Math.sqrt(r*r+s*s),y=(2*l*n*r*r-2*o*r*r*r-c*r*r*a+3*c*n*r*s-2*i*r*r*s+3*l*r*a*s-l*n*s*s-2*o*r*s*s+2*c*a*s*s-2*i*s*s*s)*(c*r-l*s)/(x*x*x*x*x);return-y}var $e=["rod","pin","slider","colinear","f2k","rope"];const b=document.getElementById("mechanism");b.addEventListener("touchstart",function(e){var t=e.touches[0],n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});b.dispatchEvent(n)});b.addEventListener("touchend",function(e){var t=new MouseEvent("mouseup",{});b.dispatchEvent(t)});b.addEventListener("touchmove",function(e){if(!(e.touches.length>1)&&N!==null){e.preventDefault();var t=e.touches[0],n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});b.dispatchEvent(n)}});const u=b.getContext("2d");window.data={duration:50,timestep:1,projectile:3,mainaxle:0,armtip:1,axleheight:8,particles:[{x:100,y:100,mass:1,hovered:!1}],constraints:{rod:[],slider:[]}};async function _e(){return new Promise(e=>{setTimeout(()=>{e()},1)})}async function Me(){await new Promise(e=>{requestAnimationFrame(()=>{e()})})}async function ot(){if(window.data.timestep!=0){var e=JSON.stringify(window.data),[t,n]=be(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,fe),a=window.data.timestep;window.data.timestep=0;var o=0,i=0;for(var r of t){for(;n[0][i+1]<o;)i+=1;o+=a;var s=JSON.parse(n[1][i]);window.data.constraints=De(s);for(var l=0;l<window.data.particles.length;l++)window.data.particles[l].x=r[2*l],window.data.particles[l].y=r[2*l+1];k(),await Me()}window.data=JSON.parse(e),k()}}function fe(e){e[2*window.data.armtip]-e[2*window.data.projectile],e[2*window.data.armtip+1]-e[2*window.data.projectile+1],e[2*window.data.armtip]-e[2*window.data.mainaxle],e[2*window.data.armtip+1]-e[2*window.data.mainaxle+1];var t=e[2*window.data.projectile+2*window.data.particles.length],n=e[2*window.data.projectile+2*window.data.particles.length+1];return t>40&&n>0}function se(){const[e,t]=be(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,fe);window.constraint_log=t;var n=Math.max(...t[1].map(JSON.parse).map(d=>Math.max(...d.map(p=>Math.abs(p.force)))).slice(1)),a=-window.data.particles[window.data.mainaxle].y,o=-window.data.particles[window.data.mainaxle].y,i=0;for(var r of e){for(var s=0;s<window.data.particles.length;s++)r[2*s]<2e3&&(o=Math.min(o,-r[2*s+1])),a=Math.max(a,-r[2*window.data.mainaxle+1]);i=Math.max(i,2*Math.max(0,-r[2*window.data.particles.length+2*window.data.projectile+1])*r[2*window.data.particles.length+2*window.data.projectile])}var l=a-o,c=Math.sqrt(Math.pow(window.data.particles[window.data.armtip].x-window.data.particles[window.data.mainaxle].x,2)+Math.pow(window.data.particles[window.data.armtip].y-window.data.particles[window.data.projectile].y,2));return i=i/Math.max(l,.75*c)*window.data.axleheight,[e,i,t,n]}function k(){if(Pe(),u.save(),u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,b.width,b.height),u.restore(),u.setTransform(1,0,0,1,0,0),window.data.particles.length>1&&window.data.constraints.rod.length+window.data.constraints.slider.length>1&&window.data.timestep>0&&typeof window.data.timestep=="number"){var[e,t,n,a]=se();document.getElementById("range").innerText=t.toFixed(1),document.getElementById("peakLoad").innerText=a.toFixed(1);var o=0,i=0;e.forEach(r=>{for(;n[0][i+1]<o;)i+=1;o+=window.data.timestep;for(let c=0;c<window.data.constraints.rod.length;c++)if(window.data.constraints.rod[c].oneway!=!0){const d=window.data.constraints.rod[c],p=d.p1*2,w=d.p2*2;u.beginPath(),u.moveTo(r[p],r[p+1]),u.lineTo(r[w],r[w+1]),u.strokeStyle="rgba(255, 0, 0, 0.2)",u.stroke()}for(let c=0;c<window.data.constraints.rope.length;c++)if(window.data.constraints.rope[c].oneway!=!0){const d=window.data.constraints.rope[c],p=d.p1*2,w=d.p3*2;u.beginPath(),u.moveTo(r[p],r[p+1]);for(var s of window.data.constraints.rope[c].pulleys){var l=s.idx*2;u.lineTo(r[l],r[l+1])}u.lineTo(r[w],r[w+1]),u.strokeStyle="rgba(255, 0, 0, 0.2)",u.stroke()}}),u.strokeStyle="black"}u.lineWidth=3,window.data.constraints.rod.forEach(r=>{const s=window.data.particles[r.p1],l=window.data.particles[r.p2];u.beginPath(),u.moveTo(s.x,s.y),u.lineTo(l.x,l.y),u.strokeStyle=r.hovered?"yellow":"black",u.stroke()}),window.data.constraints.rope.forEach(r=>{const s=window.data.particles[r.p1],l=window.data.particles[r.p3];u.setLineDash([8,8]),u.beginPath(),u.moveTo(s.x,s.y);for(var c of r.pulleys){const d=window.data.particles[c.idx];u.lineTo(d.x,d.y)}u.lineTo(l.x,l.y),u.strokeStyle=r.hovered?"yellow":"black",u.stroke(),u.setLineDash([])}),window.data.constraints.slider.concat(window.data.constraints.pin.flatMap(r=>[{p:r.p,normal:{x:0,y:1}},{p:r.p,normal:{x:1,y:0}}])).forEach(r=>{const s=window.data.particles[r.p],l=40,c=Math.atan2(r.normal.y,r.normal.x)+Math.PI/2;u.beginPath(),u.moveTo(s.x-l*Math.cos(c),s.y-l*Math.sin(c)),u.lineTo(s.x+l*Math.cos(c),s.y+l*Math.sin(c)),u.strokeStyle=r.hovered?"yellow":"black",u.stroke()}),window.data.constraints.colinear.concat(window.data.constraints.f2k).forEach(r=>{const s=window.data.particles[r.base],l=window.data.particles[r.reference],c=window.data.particles[r.slider],d=Math.sqrt((s.x-l.x)*(s.x-l.x)+(s.y-l.y)*(s.y-l.y)),p=(s.x-l.x)/d,w=(s.y-l.y)/d,m=Math.abs(p*(s.y-c.y)-w*(s.x-c.x));u.beginPath(),u.arc(c.x,c.y,m,0,Math.PI*2),u.strokeStyle="grey",u.stroke()}),u.lineWidth=1,window.data.particles.forEach((r,s)=>{const l=Math.cbrt(r.mass)*4;u.beginPath(),u.arc(r.x,r.y,l,0,Math.PI*2),u.fillStyle=r.hovered?"yellow":"black",u.strokeStyle="black",s==window.data.projectile&&(u.fillStyle="lightblue",u.strokeStyle="blue"),u.fill(),u.stroke(),u.font="18px Arial",u.textAlign="center",u.textBaseline="middle",u.fillStyle="black",u.fillText(`P${s+1}`,r.x,r.y-l-10)})}function rt(){const e={x:100,y:100,mass:1,hovered:!1};window.data.particles.push(e),M()}function it(e,t,n){window.data.particles[e][t]=Number(n),k()}function st(e){window.data.particles.splice(e,1);for(var t in window.data.constraints)for(var n=window.data.constraints[t],a=!1;!a;){a=!0;for(var o=0;o<n.length;o++){var i=n[o],r=!1;for(var s of["p","p1","p2","p3","reference","base","slider"])i[s]===e&&(r=!0);r&&(a=!1,n.splice(o,1))}}for(var s of["projectile","armtip","mainaxle"])window.data[s]===e&&(window.data[s]=0);M()}function lt(e){let t={};if(e==="rod"){if(window.data.particles.length<2){alert("At least two particles are required to create a rod constraint.");return}var n=[];for(let i=window.data.particles.length-1;i>=0;i--)for(let r=window.data.particles.length-1;r>=0;r--)ie(i,r)||n.push([i,r]);t={p1:n[0][0],p2:n[0][1],hovered:!1},window.data.constraints.rod.push(t)}else if(e==="slider"){if(window.data.particles.length<1){alert("At least one particle is required to create a slider constraint.");return}var a=window.data.constraints.slider,o=window.data.particles.length-1;a.length>0&&a[a.length-1].p==o&&a[a.length-1].normal.x==0&&a[a.length-1].normal.y==1?t={p:o,normal:{x:1,y:0},hovered:!1}:t={p:o,normal:{x:0,y:1},hovered:!1},window.data.constraints.slider.push(t)}else if(e==="colinear")t={reference:0,slider:1,base:2},window.data.constraints.colinear.push(t);else if(e==="pin")t={p:window.data.particles.length-1},window.data.constraints.pin.push(t);else if(e==="f2k")t={reference:0,slider:1,base:2},window.data.constraints.f2k.push(t);else if(e==="rope")t={p1:0,pulleys:[],p3:2},window.data.constraints.rope.push(t);else{console.error("Unknown constraint type:",e);return}M()}function ct(e,t,n){const a=+e.value,o=window.data.constraints.rope[t];o.pulleys[n].idx=a,M()}function dt(e,t,n){const a=e.value,o=window.data.constraints.rope[t];o.pulleys[n].wrapping=a,M()}function pt(e){window.data.constraints.rope[e].pulleys.pop(),M()}function wt(e){window.data.constraints.rope[e].pulleys.push({idx:0,wrapping:"both"}),M()}function ut(e,t,n,a){const o=a.includes("normal")?parseFloat(e.value):parseInt(e.value),i=window.data.constraints[t][n];a==="p1"||a==="p2"||a==="p"?(i[a]=o,M()):a==="normalX"||a==="normalY"?(i.normal[a.slice(-1).toLowerCase()]=o,k()):(i[a]=o,M())}function ft(e,t){window.data.constraints[e].splice(t,1),M()}function he(){var e=Math.min(window.screen.width,window.innerWidth);console.log(e),e>1040?(e-=440,document.getElementById("constraintsControl").style.width="400px",document.getElementById("particlesControl").style.width="400px",document.getElementById("allcontrols").style.flexGrow="1"):(console.log("hdfsa"),document.getElementById("constraintsControl").style.width="unset",document.getElementById("particlesControl").style.width="unset"),e=Math.min(e,window.innerHeight-130),e=Math.max(e,400),b.width=600*1.9,b.height=600*1.9,b.style.width=e+"px",b.style.height=e+"px",window.innerWidth-e>840?document.getElementById("allcontrols").style.flexDirection="row":document.getElementById("allcontrols").style.flexDirection="column",M()}function M(){k(),document.getElementById("timestep").value=window.data.timestep,document.getElementById("duration").value=window.data.duration;const e=document.getElementById("particlesControl");for(;e.children.length>1;)e.removeChild(e.lastChild);window.data.particles.forEach((c,d)=>ke(d));const t=document.getElementById("constraintsControl");for(;t.children.length>1;)t.removeChild(t.lastChild);for(var n of $e)window.data.constraints[n].forEach((c,d)=>Ce(n,d));const a=document.getElementById("presets");for(;a.children.length>0;)a.removeChild(a.lastChild);const o=document.createElement("option");o.selected="true",o.innerHTML="Presets",a.appendChild(o);for(var i of Object.keys(Se)){const c=document.createElement("option");c.innerHTML=i,c.value=i,a.appendChild(c)}for(var r of["armtip","projectile","mainaxle"]){for(var s=document.getElementById(r);s.children.length>0;)s.removeChild(s.lastChild);for(var l=0;l<window.data.particles.length;l++){const c=document.createElement("option");c.selected=window.data[r]==l,c.innerHTML=`P ${l+1}`,c.value=l,s.appendChild(c)}}document.getElementById("axleheight").value=window.data.axleheight}function me(e){for(var t of $e)e.constraints[t]===void 0&&(e.constraints[t]=[]);var n=e.particles.map(()=>0);e.constraints.slider.forEach(a=>{a.oneway||(n[a.p]+=1)}),e.constraints.slider=e.constraints.slider.filter((a,o)=>n[a.p]<2),e.constraints.pin=e.constraints.pin.concat(n.flatMap((a,o)=>[{count:a,p:o}]).filter(a=>a.count>1))}function pe(e){window.data=JSON.parse(Se[e.value]),me(window.data);var[t,n,a,o]=se(),i=999,r=999,s=0,l=0;t.forEach(p=>{for(var w=0;w<p.length/2;w+=2){var m=p[w],x=p[w+1];i=Math.min(m,i),w/2!=window.data.projectile&&(s=Math.max(s,m)),m<1200&&(r=Math.min(x,r)),l=Math.max(x,l)}});var c=Math.max(s-i,l-r);window.data.duration=Math.round(window.data.duration*Math.sqrt(1/c*.8*600*1.9));for(var d of window.data.particles)d.x-=i,d.x/=c,d.x*=.8,d.x+=.1,d.x*=600*1.9,d.y-=r,d.y/=c,d.y*=.8,d.y+=.1,d.y*=600*1.9;M()}function ke(e){const t=document.createElement("div");t.className="control-box",t.innerHTML=`
                P ${1+e} <label>Mass <input type="text" min="1" max="500" value="${window.data.particles[e].mass}" oninput="updateParticle(${e}, 'mass', this.value)"></label>
                <label>X <input type="text" min="0" max="${b.width}" value="${window.data.particles[e].x}" oninput="updateParticle(${e}, 'x', this.value)"></label>
                <label>Y <input type="text" min="0" max="${b.height}" value="${window.data.particles[e].y}" oninput="updateParticle(${e}, 'y', this.value)"></label>
                ${e==data.particles.length-1?`<button class=delete onclick="deleteParticle(${e})">X</button>`:""}
              `,t.addEventListener("mouseenter",()=>{window.data.particles[e].hovered=!0,k()}),t.addEventListener("mouseleave",()=>{window.data.particles[e].hovered=!1,k()}),document.getElementById("particlesControl").appendChild(t)}function ie(e,t){if(e==t)return!0;for(var n of window.data.constraints.rod)if(n.p1==e&&n.p2==t||n.p1==t&&n.p2==e||e==t)return!0;return!1}function Ce(e,t){const n=document.createElement("div");if(n.className="control-box",n.dataset.type=e,n.dataset.index=t,e==="rod")n.innerHTML=`Rod
                    <select name="p1" onchange="updateConstraint(this, 'rod', ${t}, 'p1')">
            	   ${window.data.particles.map((a,o)=>o).filter(a=>!ie(window.data.constraints.rod[t].p2,a)||a==window.data.constraints.rod[t].p1).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[t].p1?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                    <select name="p2" onchange="updateConstraint(this, 'rod', ${t}, 'p2')">
            	   ${window.data.particles.map((a,o)=>o).filter(a=>!ie(window.data.constraints.rod[t].p1,a)||a==window.data.constraints.rod[t].p2).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[t].p2?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    One way
            			<input type="checkbox" oninput="window.data.constraints.rod[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rod[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('rod', ${t})">X</button>
                `;else if(e==="slider"){const a=window.data.constraints.slider[t];n.innerHTML=`
                  <label>
            		Slider
                    <select name="p" onchange="updateConstraint(this, 'slider', ${t}, 'p')">
                      ${window.data.particles.map((o,i)=>`<option value="${i}" ${i===a.p?"selected":""}>P ${i+1}</option>`).join("")}
                    </select>
                  </label>
                  <label>Normal X <input type="range" name="normalX" min="-1" max="1" step="0.1" value="${a.normal.x}" oninput="updateConstraint(this, 'slider', ${t}, 'normalX')"></label>
                  <label>Normal Y <input type="range" name="normalY" min="-1" max="1" step="0.1" value="${a.normal.y}" oninput="updateConstraint(this, 'slider', ${t}, 'normalY')"></label>
		  One way
            			<input type="checkbox" oninput="window.data.constraints.slider[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.slider[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('slider', ${t})">X</button>
                `}else e==="colinear"?n.innerHTML=`Roller Track1
                    <select name="reference" onchange="updateConstraint(this, 'colinear', ${t}, 'reference')">
            	   ${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Slide
                    <select name="slider" onchange="updateConstraint(this, 'colinear', ${t}, 'slider')">

            	   ${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Track2
                    <select name="base" onchange="updateConstraint(this, 'colinear', ${t}, 'base')">

            	   ${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
            			<input type="checkbox" oninput="window.data.constraints.colinear[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.colinear[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('colinear', ${t})">X</button>
                `:e==="pin"?n.innerHTML=`Pin <select onchange="updateConstraint(this, 'pin', ${t}, 'p')">${window.data.particles.map((a,o)=>`<option value="${o}" ${o===window.data.constraints.pin[t].p?"selected":""}>P ${o+1}</option>`).join("")}</select>

                  <button class=delete onclick="deleteConstraint('pin', ${t})">X</button>
		  `:e==="f2k"?n.innerHTML=`F2k <label>Arm Tip
                    <select name="reference" onchange="updateConstraint(this, 'f2k', ${t}, 'reference')">
            	   ${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    Roller 
                    <select name="slider" onchange="updateConstraint(this, 'f2k', ${t}, 'slider')">

            	   ${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    Arm Base
                    <select name="base" onchange="updateConstraint(this, 'f2k', ${t}, 'base')">

            	   ${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    </label> <label>
		    One way
            			<input type="checkbox" oninput="window.data.constraints.f2k[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.f2k[t].oneway?"checked":""}></input></label>
                  <button class=delete onclick="deleteConstraint('f2k', ${t})">X</button>
                `:e==="rope"&&(n.innerHTML=`
				Rope and pulley.
				<label>
				Fixed end:
				<select name="p1" onchange="updateConstraint(this, 'rope', ${t}, 'p1')">
								${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p1?"selected":""}>P ${a+1}</option>`).join("")}
				</select></label>
${window.data.constraints.rope[t].pulleys.map((a,o)=>`
<label>Pulley
<select name="p2" onchange="updatePulley(this, ${t}, ${o})">

${window.data.particles.map((i,r)=>r).map(i=>`<option value="${i}" ${i===a.idx?"selected":""}>P ${i+1}</option>`).join("")}
</select>
<select onchange="updatePulleyDirection(this, ${t}, ${o})">
${["both","cw","ccw","cw_drop","ccw_drop"].map(i=>`<option value=${i} ${i==a.wrapping?"selected":""}>${i}</option>`).join("")}
</select></label>
`).join("")}
<button onclick="addPulley(${t})">+</button>
<button onclick="removePulley(${t})">-</button>
<label>Fixed end
<select name="p3" onchange="updateConstraint(this, 'rope', ${t}, 'p3')">

${window.data.particles.map((a,o)=>o).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p3?"selected":""}>P ${a+1}</option>`).join("")}
</select>
</label>
<button class=delete onclick="deleteConstraint('rope', ${t})">X</button>
<input type="checkbox" oninput="window.data.constraints.rope[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rope[t].oneway?"checked":""}></input>
`);n.addEventListener("mouseenter",()=>{window.data.constraints[e][t].hovered=!0,k()}),n.addEventListener("mouseleave",()=>{window.data.constraints[e][t].hovered=!1,k()}),document.getElementById("constraintsControl").appendChild(n)}let N=null;function Ee(e,t){var n=window.data.particles.findIndex(a=>{const o=Math.sqrt((a.x-e)**2+(a.y-t)**2),i=Math.cbrt(a.mass)*10;return o<i});return n==-1&&(n=window.data.particles.findIndex(a=>{const o=Math.sqrt((a.x-e)**2+(a.y-t)**2),i=15+Math.cbrt(a.mass)*10;return o<i})),n}b.addEventListener("mousedown",function(e){const t=b.getBoundingClientRect(),n=b.width/t.width,a=b.height/t.height,o=(e.clientX-t.left)*n,i=(e.clientY-t.top)*a,r=Ee(o,i);r!==-1?(N=r,b.style.cursor="move"):(startX=e.clientX-b.offsetLeft,startY=e.clientY-b.offsetTop)});b.addEventListener("mousemove",function(e){if(N!==null){const t=b.getBoundingClientRect(),n=b.width/t.width,a=b.height/t.height,o=(e.clientX-t.left)*n,i=(e.clientY-t.top)*a;window.data.particles[N].x=o,window.data.particles[N].y=i,k()}});b.addEventListener("mouseup",function(e){N!==null&&(M(),N=null,b.style.cursor="default")});b.addEventListener("mouseleave",function(e){N!==null&&(M(),N=null,b.style.cursor="default")});function Pe(){localStorage.setItem("mechanismData",JSON.stringify(window.data))}function Ie(){const e=localStorage.getItem("mechanismData");if(e){window.data=JSON.parse(e),me(window.data);try{M()}catch{pe({value:"Hinged Counterweight"})}}else pe({value:"Hinged Counterweight"})}window.addEventListener("resize",he);window.onload=()=>{Ie(),he(),fetch("https://apj.hgreer.com/jstreb",{method:"GET",cache:"no-store",mode:"no-cors"})};var Se={"Hinged Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":588,"y":440.7,"mass":10},{"x":668,"y":673.6,"mass":1},{"x":586,"y":533.7,"mass":100}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Fixed Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":668,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Floating Arm Trebuchet":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":487.0,"y":517.0,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":589,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',F2k:'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.6,"duration":35,"particles":[{"x":454,"y":516,"mass":1},{"x":436.6,"y":513.0,"mass":4},{"x":560.3,"y":211.5,"mass":100},{"x":652.9,"y":621.8,"mass":1}],"constraints":{"rod":[{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":1,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":0,"normal":{"x":0,"y":1}}],"colinear":[],"f2k":[{"reference":1,"slider":0,"base":2}],"rope":[]}}',"Floating Arm Whipper (NASAW)":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":37,"particles":[{"x":496.3,"y":477.6,"mass":1},{"x":677.5,"y":471.0,"mass":4},{"x":468.0,"y":453.5,"mass":10},{"x":557.0,"y":431.8,"mass":1},{"x":563.0,"y":340.7,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":4,"normal":{"x":0.6,"y":0}}],"colinear":[]}}',Whipper:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3,"duration":60,"particles":[{"x":536,"y":472.7,"mass":1},{"x":759,"y":451,"mass":4},{"x":483,"y":498,"mass":10},{"x":551,"y":434,"mass":1},{"x":560,"y":368,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":0}}]}}',Fiffer:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":20,"particles":[{"x":536,"y":472.7,"mass":1},{"x":484,"y":656,"mass":4},{"x":504,"y":433,"mass":10},{"x":644,"y":661,"mass":1},{"x":653,"y":451,"mass":10},{"x":749,"y":428,"mass":1},{"x":749,"y":483,"mass":500},{"x":566,"y":505,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":7,"p2":6},{"p1":6,"p2":4},{"p1":4,"p2":5}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":7,"normal":{"x":0.7,"y":1}},{"p":7,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0.7,"y":1}}]}}',"Floating Arm King Arthur":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":40,"particles":[{"x":536,"y":472.7,"mass":1},{"x":527,"y":610,"mass":4},{"x":534,"y":418,"mass":10},{"x":698,"y":608,"mass":1},{"x":560,"y":331,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":-0.5,"y":0},"oneway":true},{"p":1,"normal":{"x":0.7,"y":0},"oneway":true},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Launch Ness Monster":'{"projectile":3,"mainaxle":2,"armtip":1,"axleheight":8,"timestep":0.3,"duration":80,"particles":[{"x":600.7,"y":746.2,"mass":10},{"x":559.1,"y":774.0,"mass":4},{"x":660.2,"y":530.0,"mass":100},{"x":703.9,"y":796.7,"mass":1},{"x":810,"y":530,"mass":10},{"x":552,"y":500,"mass":10},{"x":458,"y":666,"mass":10},{"x":886.1,"y":662.4,"mass":10}],"constraints":{"rod":[{"p1":2,"p2":1},{"p1":3,"p2":1},{"p1":6,"p2":5},{"p1":5,"p2":2},{"p1":4,"p2":2},{"p1":4,"p2":7},{"p1":5,"p2":4}],"slider":[{"p":0,"normal":{"x":1,"y":2.1}},{"p":0,"normal":{"x":-0.6,"y":1.6}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":6,"normal":{"x":0.6,"y":1}},{"p":6,"normal":{"x":0,"y":1}},{"p":7,"normal":{"x":1,"y":1}},{"p":7,"normal":{"x":0,"y":1}}],"colinear":[{"reference":1,"slider":0,"base":2}]}}',"Pulley Sling":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":35,"particles":[{"x":546.3,"y":584.3,"mass":1},{"x":285.6,"y":791.6,"mass":4},{"x":560.6,"y":481.2,"mass":10},{"x":1000.9,"y":742.8,"mass":1},{"x":645.5,"y":541.0,"mass":500},{"x":72.7,"y":730.2,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":5,"normal":{"x":1,"y":1}},{"p":5,"normal":{"x":0,"y":1}}],"colinear":[],"rope":[{"p1":5,"pulleys":[{"idx":1,"wrapping":"both"}],"p3":3}]}}'};let oe=!1;async function ht(){if(oe){oe=!1,document.getElementById("optimize").innerText="Optimize";return}document.getElementById("optimize").innerText="Stop",oe=!0;for(var e=500,t=e,n=40,a=+document.getElementById("range").innerText;oe;){var o=JSON.stringify(window.data);for(var i of window.data.particles)Math.random()>.5&&(i.x%100!=0&&(i.x=i.x+n*(.5-Math.random())),i.y%100!=0?i.y=i.y+n*(.5-Math.random()):i.mass%1!=0&&(i.mass=Math.abs(i.mass+.001*n*(.5-Math.random()))));var[s,r,s,l]=se();t%20==0&&await _e();var c=r;c>a?(t=e,a=r,k()):(window.data=JSON.parse(o),t-=1,t==0&&(t=e,n*=.6))}k()}let re=!1;async function mt(){if(re){re=!1,document.getElementById("gentlify").innerText="Gentlify";return}document.getElementById("gentlify").innerText="Stop",re=!0;for(var e=500,t=e,n=40,a=+document.getElementById("range").innerText,o=+document.getElementById("peakLoad").innerText;re;){var i=JSON.stringify(window.data);for(var r of window.data.particles)Math.random()>.5&&(r.x%100!=0&&(r.x=r.x+n*(.5-Math.random())),r.y%100!=0?r.y=r.y+n*(.5-Math.random()):r.mass=Math.abs(r.mass+.001*n*(.5-Math.random())));var[l,s,l,c]=se();t%20==0&&await _e();var d=c;console.log(d,c,s,a),!(d<o)||s<a?(window.data=JSON.parse(i),t-=1,t==0&&(t=e,n*=.6)):(t=e,o=c,k())}k()}function vt(){const e=new Blob([JSON.stringify(window.data)],{type:"application/json"}),t=prompt("Enter a filename for your window.data:","window.data.json");if(!t){alert("Save cancelled.");return}const n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}function yt(){const e=document.createElement("input");e.type="file",e.onchange=t=>{const n=t.target.files[0],a=new FileReader;a.onload=o=>{try{window.data=JSON.parse(o.target.result),me(window.data),M()}catch{alert("Error parsing JSON!")}},a.readAsText(n)},document.body.appendChild(e),e.click(),document.body.removeChild(e)}window.doAnimate=ot;window.terminate=fe;window.drawMechanism=k;window.createParticle=rt;window.updateParticle=it;window.deleteParticle=st;window.createConstraint=lt;window.updateConstraint=ut;window.deleteConstraint=ft;window.resizeCanvas=he;window.updateUI=M;window.loadPreset=pe;window.createParticleControlBox=ke;window.constraintExists=ie;window.createConstraintControlBox=Ce;window.getParticleAtPosition=Ee;window.saveMechanism=Pe;window.loadMechanism=Ie;window.optimize=mt;window.optimize_range=ht;window.save=vt;window.load=yt;window.updatePulley=ct;window.updatePulleyDirection=dt;window.addPulley=wt;window.removePulley=pt;window.waitForAnimationFrame=Me;
