(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();function V(e,t){const o=e.length,a=e[0].length,n=new Array(o).fill(0).map(()=>new Array(o));for(let l=0;l<o;l++){var i=e[l];for(let c=0;c<o;c++){var r=0,s=t[c];for(let f=0;f<a;f++)r+=i[f]*s[f];n[l][c]=r}}return n}function R(e,t){const o=e.length,a=e[0].length,n=new Array(o).fill(0).map(()=>new Array(a));for(let i=0;i<o;i++){let r=n[i],s=e[i];for(let l=0;l<a;l++)r[l]=s[l]/t[l]}return n}function P(e,t){const o=new Array(t.length);for(var a=0;a<t.length;a++)o[a]=t[a]*e;return o}function k(e){const t=new Array(e[0].length);for(var o=0;o<e[0].length;o++){for(var a=0,n=0;n<e.length;n++)a+=e[n][o];t[o]=a}return t}function C(e,t){return[e[0]-t[0],e[1]-t[1]]}function Z(e,t){return new Array(e.length).fill(0).map((o,a)=>e[a]-t[a])}function ee(e,t){const o=e.length,a=e[0].length,n=t.length,i=t[0].length;a!=n&&(console.log(a),console.log(n),assert(a==n));const r=new Array(o).fill(0).map(()=>new Array(i).fill(0));for(let s=0;s<o;s++)for(let l=0;l<i;l++)for(let c=0;c<a;c++)r[s][l]+=e[s][c]*t[c][l];return r}function te(e,t){const o=e.length;for(let n=0;n<o;n++){let i=Math.abs(e[n][n]),r=n;for(let c=n+1;c<o;c++)Math.abs(e[c][n])>i&&(i=Math.abs(e[c][n]),r=c);const s=e[r];e[r]=e[n],e[n]=s;const l=t[r];t[r]=t[n],t[n]=l;for(let c=n+1;c<o;c++){const f=-e[c][n]/e[n][n];for(let w=n;w<o;w++)n===w?e[c][w]=0:e[c][w]+=f*e[n][w];t[c]+=f*t[n]}}const a=new Array(o).fill(0);for(let n=o-1;n>-1;n--){a[n]=t[n]/e[n][n];for(let i=n-1;i>-1;i--)t[i]-=e[i][n]*a[n]}return a}function z(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function D(e,t){return e[0]*t[1]-e[1]*t[0]}function p(e,t){return[e[2*t],e[2*t+1]]}function b(e,t,o){e[2*o]=t[0],e[2*o+1]=t[1]}function j(e,t,o){this.p1=e,this.p2=t,this.oneway=o}function B(e,t,o){this.p1=e,this.p2=t,this.p3=o}function A(e,t,o){this.reference=e,this.slide=t,this.base=o,this.fatmode=!1}function O(e,t,o,a){this.reference=e,this.slide=t,this.base=o,this.oneway=a}function X(e,t,o){this.p=e,this.n=z(t),this.oneway=o}function ae(e,t,o,a){this.forces=Array(t.length).fill([0,-1]).flat(),this.constraints=e,this.masses=t.flatMap(n=>[n,n]),this.positions=o,this.velocities=a}function H(e,t,o,a,n){var i=Date.now();let r=[],s=[],l=[];for(var c of e)r.push(c.mass),s.push(c.x),s.push(c.y);for(var f of t.rod)l.push(new j(f.p1,f.p2,f.oneway));for(var w of t.slider)l.push(new X(w.p,[w.normal.x,w.normal.y],w.oneway));for(var h of t.colinear)l.push(new O(h.reference,h.slider,h.base,h.oneway));for(var v of t.f2k)l.push(new A(v.reference,v.slider,v.base));for(var m of t.rope)l.push(new B(m.p1,m.pulleys.slice(),m.p3));var y=new ae(l,r,s,new Array(s.length).fill(0));y.terminate=n;let x=y.positions.concat(y.velocities),_=ne(y,x,o,a);var S=Date.now();return document.getElementById("simtime").innerText=S-i,_}function ne(e,t,o,a){for(var n=t,i=0,r=o,s=[],l=!1;i<a&&!l;){i+=r;var[c,h]=I(e,n),[f,h]=I(e,k([n,P(r/2,c)])),[w,h]=I(e,k([n,P(r/2,f)])),[v,l]=I(e,k([n,P(r,w)]));n=k([n,P(r/6,k([c,P(2,f),P(2,w),v]))]),s.push(n)}return s}function oe(e){var t=e.constraints.map(s=>{if(s instanceof j)return ie(s,e);if(s instanceof X)return re(s,e);if(s instanceof O)return pe(s,e);if(s instanceof A)return ue(s,e);if(s instanceof B)return le(s,e)}),o=R(t,e.masses);o=V(o,t);var a=e.constraints.map(s=>{if(s instanceof j)return se(s,e);if(s instanceof X)return de(s,e);if(s instanceof O)return we(s,e);if(s instanceof A)return fe(s,e);if(s instanceof B)return ce(s,e)});let n=te(o,a),i=Z(R(ee([n],t),e.masses)[0],e.forces);for(var r=0;r<n.length;r++)if(n[r]>0&&e.constraints[r].oneway===!0){e.constraints.splice(r,1);break}return[i,!1]}function I(e,t){e.positions=t.slice(0,e.positions.length),e.velocities=t.slice(e.positions.length,t.length);let[o,a]=oe(e);if(e.terminate(t)){for(var n=window.data.projectile,i=0;i<e.constraints.length;i++)if(e.constraints[i].p1===n||e.constraints[i].p2===n||e.constraints[i].p3===n){e.constraints.splice(i,1);break}}return[e.velocities.concat(o),!1]}function ie(e,t){let o=z(C(p(t.positions,e.p1),p(t.positions,e.p2))),a=new Array(t.positions.length).fill(0);return b(a,o,e.p2),b(a,[-o[0],-o[1]],e.p1),a}function re(e,t){let o=new Array(t.positions.length).fill(0);return b(o,e.n,e.p),o}function se(e,t){let o=C(p(t.positions,e.p1),p(t.positions,e.p2)),a=C(p(t.velocities,e.p1),p(t.velocities,e.p2)),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]);return(a[0]*a[0]+a[1]*a[1])/n}function le(e,t){var o=[];o.push(e.p1);for(var a of e.p2)o.push(a.idx);o.push(e.p3);for(var n=1;n<o.length-1;n++){var i=p(t.positions,o[n-1]),r=p(t.positions,o[n]),s=p(t.positions,o[n+1]),l=D(C(i,r),C(r,s));if(l>0&&e.p2[n-1].wrapping=="ccw"||l<0&&e.p2[n-1].wrapping=="cw"){e.p2.splice(n-1,1);break}}o=[],o.push(e.p1);for(var a of e.p2)o.push(a.idx);o.push(e.p3);let c=new Array(t.positions.length).fill(0);for(var n=0;n<o.length-1;n++){let w=o[n],h=o[n+1],v=z(C(p(t.positions,w),p(t.positions,h))),m=p(c,w);b(c,C(m,v),w),b(c,v,h)}return c}function ce(e,t){var o=0,a=[];a.push(e.p1);for(var n of e.p2)a.push(n.idx);a.push(e.p3);for(var i=0;i<a.length-1;i++){let r=a[i],s=a[i+1],l=C(p(t.positions,r),p(t.positions,s)),c=C(p(t.velocities,r),p(t.velocities,s)),f=Math.sqrt(l[0]*l[0]+l[1]*l[1]);o+=Math.pow(D(l,c),2)/(f*f*f)}return o}function de(e,t){var o=p(t.forces,e.p);return e.n[0]*o[0]+e.n[1]*o[1]}function pe(e,t){var[o,a]=p(t.positions,e.slide);p(t.velocities,e.slide);var[n,i]=p(t.positions,e.reference);p(t.velocities,e.reference);var[r,s]=p(t.positions,e.base);p(t.velocities,e.base),o=o-r,a=a-s,n=n-r,i=i-s;var l=Math.sqrt(n*n+i*i),c=l*l*l,f=-i/l,w=n/l,h=(o*n*i+a*i*i)/c,v=-(o*n*n+n*a*i)/c,m=-f-h,y=-w-v;let x=new Array(t.positions.length).fill(0);return b(x,[f,w],e.slide),b(x,[h,v],e.reference),b(x,[m,y],e.base),x}function we(e,t){var[o,a]=p(t.positions,e.slide),[n,i]=p(t.velocities,e.slide),[r,s]=p(t.positions,e.reference),[l,c]=p(t.velocities,e.reference),[f,w]=p(t.positions,e.base),[h,v]=p(t.velocities,e.base);o=o-f,a=a-w,n=n-h,i=i-v,r=r-f,s=s-w,l=l-h,c=c-v;var m=Math.sqrt(r*r+s*s),y=r/m,x=s/m,_=(c*y-l*x)*(((2*l*o-c*a)*y*y+(c*o+l*a)*3*y*x+(2*c*a-l*o)*x*x)/(m*m)-2*(n*y+i*x)/m);return-_}function ue(e,t){var[o,a]=p(t.positions,e.slide);p(t.velocities,e.slide);var[n,i]=p(t.positions,e.reference);p(t.velocities,e.reference);var[r,s]=p(t.positions,e.base);p(t.velocities,e.base),o=o-r,a=a-s,n=n-r,i=i-s;let l=new Array(t.positions.length).fill(0);if(i<0){if(!e.fatmode){var c=o,f=n-o;e.ratio=c/f}e.fatmode=!0}if(e.fatmode)return b(l,[0,1],e.base),b(l,[0,e.ratio],e.reference),l;var w=Math.sqrt(n*n+i*i),h=w*w*w,v=-i/w,m=n/w,y=(o*n*i+a*i*i)/h,x=-(o*n*n+n*a*i)/h,_=-v-y,S=-m-x;return b(l,[v,m],e.slide),b(l,[y,x],e.reference),b(l,[_,S],e.base),l}function fe(e,t){if(e.fatmode)return-1-e.ratio;var[o,a]=p(t.positions,e.slide),[n,i]=p(t.velocities,e.slide),[r,s]=p(t.positions,e.reference),[l,c]=p(t.velocities,e.reference),[f,w]=p(t.positions,e.base),[h,v]=p(t.velocities,e.base);o=o-f,a=a-w,n=n-h,i=i-v,r=r-f,s=s-w,l=l-h,c=c-v;var m=Math.sqrt(r*r+s*s),y=(2*l*o*r*r-2*n*r*r*r-c*r*r*a+3*c*o*r*s-2*i*r*r*s+3*l*r*a*s-l*o*s*s-2*n*r*s*s+2*c*a*s*s-2*i*s*s*s)*(c*r-l*s)/(m*m*m*m*m);return-y}const u=document.getElementById("mechanism");u.addEventListener("touchstart",function(e){var t=e.touches[0],o=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});u.dispatchEvent(o)});u.addEventListener("touchend",function(e){var t=new MouseEvent("mouseup",{});u.dispatchEvent(t)});u.addEventListener("touchmove",function(e){if(!(e.touches.length>1)&&E!==null){e.preventDefault();var t=e.touches[0],o=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});u.dispatchEvent(o)}});const d=u.getContext("2d");window.data={duration:50,timestep:1,projectile:3,mainaxle:0,armtip:1,axleheight:8,particles:[{x:100,y:100,mass:1,hovered:!1}],constraints:{rod:[],slider:[]}};async function he(){return new Promise(e=>{setTimeout(()=>{e()},1)})}async function me(){await new Promise(e=>{requestAnimationFrame(()=>{e()})})}async function ve(){if(window.data.timestep!=0){var e=JSON.stringify(window.data),t=H(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,F);window.data.timestep=0;for(var o of[window.data.constraints.rod,window.data.constraints.slider])for(var a=o.length,n=0;n<a;n++)o[n].oneway&&(o.splice(n,1),n-=1,a-=1);for(var i of t){for(var n=0;n<window.data.particles.length;n++)window.data.particles[n].x=i[2*n],window.data.particles[n].y=i[2*n+1];$(),await me()}window.data=JSON.parse(e),$()}}function F(e){e[2*window.data.armtip]-e[2*window.data.projectile],e[2*window.data.armtip+1]-e[2*window.data.projectile+1],e[2*window.data.armtip]-e[2*window.data.mainaxle],e[2*window.data.armtip+1]-e[2*window.data.mainaxle+1];var t=e[2*window.data.projectile+2*window.data.particles.length],o=e[2*window.data.projectile+2*window.data.particles.length+1];return t>40&&o>-15}function U(){const e=H(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,F);var t=-window.data.particles[window.data.mainaxle].y,o=-window.data.particles[window.data.mainaxle].y,a=0;for(var n of e){for(var i=0;i<window.data.particles.length;i++)n[2*i]<2e3&&(o=Math.min(o,-n[2*i+1])),t=Math.max(t,-n[2*window.data.mainaxle+1]);a=Math.max(a,2*Math.max(0,-n[2*window.data.particles.length+2*window.data.projectile+1])*n[2*window.data.particles.length+2*window.data.projectile])}var r=t-o,s=Math.sqrt(Math.pow(window.data.particles[window.data.armtip].x-window.data.particles[window.data.mainaxle].x,2)+Math.pow(window.data.particles[window.data.armtip].y-window.data.particles[window.data.projectile].y,2));return a=a/Math.max(r,.75*s)*window.data.axleheight,[e,a]}function $(){if(K(),d.save(),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,u.width,u.height),d.restore(),d.setTransform(1,0,0,1,0,0),window.data.particles.length>1&&window.data.constraints.rod.length+window.data.constraints.slider.length>1&&window.data.timestep>0&&typeof window.data.timestep=="number"){var[e,t]=U();document.getElementById("range").innerText=t,e.forEach(o=>{for(let i=0;i<window.data.constraints.rod.length;i++)if(window.data.constraints.rod[i].oneway!=!0){const r=window.data.constraints.rod[i],s=r.p1*2,l=r.p2*2;d.beginPath(),d.moveTo(o[s],o[s+1]),d.lineTo(o[l],o[l+1]),d.strokeStyle="rgba(255, 0, 0, 0.2)",d.stroke()}for(let i=0;i<window.data.constraints.rope.length;i++)if(window.data.constraints.rope[i].oneway!=!0){const r=window.data.constraints.rope[i],s=r.p1*2,l=r.p3*2;d.beginPath(),d.moveTo(o[s],o[s+1]);for(var a of window.data.constraints.rope[i].pulleys){var n=a.idx*2;d.lineTo(o[n],o[n+1])}d.lineTo(o[l],o[l+1]),d.strokeStyle="rgba(255, 0, 0, 0.2)",d.stroke()}}),d.strokeStyle="black"}window.data.particles.forEach((o,a)=>{const n=Math.cbrt(o.mass)*4;d.beginPath(),d.arc(o.x,o.y,n,0,Math.PI*2),d.fillStyle=o.hovered?"yellow":"black",d.strokeStyle="black",d.fill(),d.stroke(),d.font="18px Arial",d.textAlign="center",d.textBaseline="middle",d.fillStyle="black",d.fillText(`P${a+1}`,o.x,o.y-n-10)}),d.lineWidth=3,window.data.constraints.rod.forEach(o=>{const a=window.data.particles[o.p1],n=window.data.particles[o.p2];d.beginPath(),d.moveTo(a.x,a.y),d.lineTo(n.x,n.y),d.strokeStyle=o.hovered?"yellow":"black",d.stroke()}),window.data.constraints.rope.forEach(o=>{const a=window.data.particles[o.p1],n=window.data.particles[o.p3];d.setLineDash([8,8]),d.beginPath(),d.moveTo(a.x,a.y);for(var i of o.pulleys){const r=window.data.particles[i.idx];d.lineTo(r.x,r.y)}d.lineTo(n.x,n.y),d.strokeStyle=o.hovered?"yellow":"black",d.stroke(),d.setLineDash([])}),window.data.constraints.slider.forEach(o=>{const a=window.data.particles[o.p],n=40,i=Math.atan2(o.normal.y,o.normal.x)+Math.PI/2;d.beginPath(),d.moveTo(a.x-n*Math.cos(i),a.y-n*Math.sin(i)),d.lineTo(a.x+n*Math.cos(i),a.y+n*Math.sin(i)),d.strokeStyle=o.hovered?"yellow":"black",d.stroke()}),window.data.constraints.colinear.concat(window.data.constraints.f2k).forEach(o=>{const a=window.data.particles[o.base],n=window.data.particles[o.reference],i=window.data.particles[o.slider],r=Math.sqrt((a.x-n.x)*(a.x-n.x)+(a.y-n.y)*(a.y-n.y)),s=(a.x-n.x)/r,l=(a.y-n.y)/r,c=Math.abs(s*(a.y-i.y)-l*(a.x-i.x));d.beginPath(),d.arc(i.x,i.y,c,0,Math.PI*2),d.strokeStyle="grey",d.stroke()}),d.lineWidth=1}function ye(){const e={x:100,y:100,mass:1,hovered:!1};window.data.particles.push(e),g()}function ge(e,t,o){window.data.particles[e][t]=Number(o),$()}function xe(e){console.log(window.data.particles),window.data.particles.splice(e,1),console.log(window.data.particles);for(var t in window.data.constraints)for(var o=window.data.constraints[t],a=!1;!a;){a=!0;for(var n=0;n<o.length;n++){var i=o[n],r=!1;console.log(i);for(var s of["p","p1","p2","p3","reference","base","slider"])i[s]===e&&(r=!0);r&&(a=!1,o.splice(n,1))}}for(var s of["projectile","armtip","mainaxle"])window.data[s]===e&&(window.data[s]=0);g()}function be(e){let t={};if(e==="rod"){if(window.data.particles.length<2){alert("At least two particles are required to create a rod constraint.");return}var o=[];for(let i=window.data.particles.length-1;i>=0;i--)for(let r=window.data.particles.length-1;r>=0;r--)T(i,r)||o.push([i,r]);t={p1:o[0][0],p2:o[0][1],hovered:!1},window.data.constraints.rod.push(t)}else if(e==="slider"){if(window.data.particles.length<1){alert("At least one particle is required to create a slider constraint.");return}var a=window.data.constraints.slider,n=window.data.particles.length-1;a.length>0&&a[a.length-1].p==n&&a[a.length-1].normal.x==0&&a[a.length-1].normal.y==1?t={p:n,normal:{x:1,y:0},hovered:!1}:t={p:n,normal:{x:0,y:1},hovered:!1},window.data.constraints.slider.push(t)}else if(e==="colinear")t={reference:0,slider:1,base:2},window.data.constraints.colinear.push(t);else if(e==="f2k")t={reference:0,slider:1,base:2},window.data.constraints.f2k.push(t);else if(e==="rope")t={p1:0,pulleys:[],p3:2},window.data.constraints.rope.push(t);else{console.error("Unknown constraint type:",e);return}g()}function $e(e,t,o){const a=+e.value,n=window.data.constraints.rope[t];n.pulleys[o].idx=a,g()}function Ce(e,t,o){const a=e.value,n=window.data.constraints.rope[t];n.pulleys[o].wrapping=a,g()}function Ee(e){window.data.constraints.rope[e].pulleys.pop(),g()}function Pe(e){window.data.constraints.rope[e].pulleys.push({idx:0,wrapping:"both"}),g()}function Me(e,t,o,a){const n=a.includes("normal")?parseFloat(e.value):parseInt(e.value),i=window.data.constraints[t][o];a==="p1"||a==="p2"||a==="p"?(i[a]=n,g()):a==="normalX"||a==="normalY"?(i.normal[a.slice(-1).toLowerCase()]=n,$()):(i[a]=n,g())}function _e(e,t){window.data.constraints[e].splice(t,1),g()}function q(){var e=window.innerWidth;e>1040&&(e-=440),e=Math.min(e,window.innerHeight-90),e=Math.max(e,400),u.width=600*1.9,u.height=600*1.9,u.style.width=e+"px",u.style.height=e+"px",window.innerWidth-e>840?document.getElementById("allcontrols").style.flexDirection="row":document.getElementById("allcontrols").style.flexDirection="column",g()}function g(){$(),document.getElementById("timestep").value=window.data.timestep,document.getElementById("duration").value=window.data.duration;const e=document.getElementById("particlesControl");for(;e.children.length>1;)e.removeChild(e.lastChild);window.data.particles.forEach((l,c)=>J(c));const t=document.getElementById("constraintsControl");for(;t.children.length>5;)t.removeChild(t.lastChild);window.data.constraints.rod.forEach((l,c)=>M("rod",c)),window.data.constraints.slider.forEach((l,c)=>M("slider",c)),window.data.constraints.colinear.forEach((l,c)=>M("colinear",c)),window.data.constraints.f2k.forEach((l,c)=>M("f2k",c)),window.data.constraints.rope.forEach((l,c)=>M("rope",c));const o=document.getElementById("presets");for(;o.children.length>0;)o.removeChild(o.lastChild);const a=document.createElement("option");a.selected="true",a.innerHTML="Presets",o.appendChild(a);for(var n of Object.keys(Q)){const l=document.createElement("option");l.innerHTML=n,l.value=n,o.appendChild(l)}for(var i of["armtip","projectile","mainaxle"]){for(var r=document.getElementById(i);r.children.length>0;)r.removeChild(r.lastChild);for(var s=0;s<window.data.particles.length;s++){const l=document.createElement("option");l.selected=window.data[i]==s,l.innerHTML=`P ${s+1}`,l.value=s,r.appendChild(l)}}document.getElementById("axleheight").value=window.data.axleheight}function N(e){window.data=JSON.parse(Q[e.value]),window.data.constraints.colinear===void 0&&(window.data.constraints.colinear=[]),window.data.constraints.f2k===void 0&&(window.data.constraints.f2k=[]),window.data.constraints.rope===void 0&&(window.data.constraints.rope=[]),g()}function J(e){const t=document.createElement("div");t.className="control-box",t.innerHTML=`
                <label>Mass: <input type="text" min="1" max="500" value="${window.data.particles[e].mass}" oninput="updateParticle(${e}, 'mass', this.value)"></label>
                <label>X: <input type="text" min="0" max="${u.width}" value="${window.data.particles[e].x}" oninput="updateParticle(${e}, 'x', this.value)"></label>
                <label>Y: <input type="text" min="0" max="${u.height}" value="${window.data.particles[e].y}" oninput="updateParticle(${e}, 'y', this.value)"></label>
                ${e==data.particles.length-1?`<button class=delete onclick="deleteParticle(${e})">X</button>`:""}
              `,t.addEventListener("mouseenter",()=>{window.data.particles[e].hovered=!0,$()}),t.addEventListener("mouseleave",()=>{window.data.particles[e].hovered=!1,$()}),document.getElementById("particlesControl").appendChild(t)}function T(e,t){if(e==t)return!0;for(var o of window.data.constraints.rod)if(o.p1==e&&o.p2==t||o.p1==t&&o.p2==e||e==t)return!0;return!1}function M(e,t){const o=document.createElement("div");if(o.className="control-box",o.dataset.type=e,o.dataset.index=t,e==="rod")o.innerHTML=`Rod
                    <select name="p1" onchange="updateConstraint(this, 'rod', ${t}, 'p1')">
            	   ${window.data.particles.map((a,n)=>n).filter(a=>!T(window.data.constraints.rod[t].p2,a)||a==window.data.constraints.rod[t].p1).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[t].p1?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                    <select name="p2" onchange="updateConstraint(this, 'rod', ${t}, 'p2')">
            	   ${window.data.particles.map((a,n)=>n).filter(a=>!T(window.data.constraints.rod[t].p1,a)||a==window.data.constraints.rod[t].p2).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[t].p2?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    One way:
            			<input type="checkbox" oninput="window.data.constraints.rod[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rod[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('rod', ${t})">X</button>
                `;else if(e==="slider"){const a=window.data.constraints.slider[t];o.innerHTML=`
                  <label>
            		Slider
                    <select name="p" onchange="updateConstraint(this, 'slider', ${t}, 'p')">
                      ${window.data.particles.map((n,i)=>`<option value="${i}" ${i===a.p?"selected":""}>P ${i+1}</option>`).join("")}
                    </select>
                  </label>
                  <label>Normal X: <input type="range" name="normalX" min="-1" max="1" step="0.1" value="${a.normal.x}" oninput="updateConstraint(this, 'slider', ${t}, 'normalX')"></label>
                  <label>Normal Y: <input type="range" name="normalY" min="-1" max="1" step="0.1" value="${a.normal.y}" oninput="updateConstraint(this, 'slider', ${t}, 'normalY')"></label>
		  One way:
            			<input type="checkbox" oninput="window.data.constraints.slider[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.slider[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('slider', ${t})">X</button>
                `}else e==="colinear"?o.innerHTML=`Roller Track1
                    <select name="reference" onchange="updateConstraint(this, 'colinear', ${t}, 'reference')">
            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Slide
                    <select name="slider" onchange="updateConstraint(this, 'colinear', ${t}, 'slider')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Track2
                    <select name="base" onchange="updateConstraint(this, 'colinear', ${t}, 'base')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
            			<input type="checkbox" oninput="window.data.constraints.colinear[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.colinear[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('colinear', ${t})">X</button>
                `:e==="f2k"?o.innerHTML=`F2k Arm Tip
                    <select name="reference" onchange="updateConstraint(this, 'f2k', ${t}, 'reference')">
            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Roller 
                    <select name="slider" onchange="updateConstraint(this, 'f2k', ${t}, 'slider')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Arm Base
                    <select name="base" onchange="updateConstraint(this, 'f2k', ${t}, 'base')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    One way:
            			<input type="checkbox" oninput="window.data.constraints.f2k[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.f2k[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('f2k', ${t})">X</button>
                `:e==="rope"&&(o.innerHTML=`
				Rope and pulley.
				Fixed end:
				<select name="p1" onchange="updateConstraint(this, 'rope', ${t}, 'p1')">
								${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p1?"selected":""}>P ${a+1}</option>`).join("")}
				</select>
${window.data.constraints.rope[t].pulleys.map((a,n)=>`
Pulley:
<select name="p2" onchange="updatePulley(this, ${t}, ${n})">

${window.data.particles.map((i,r)=>r).map(i=>`<option value="${i}" ${i===a.idx?"selected":""}>P ${i+1}</option>`).join("")}
</select>
<select onchange="updatePulleyDirection(this, ${t}, ${n})">
${["both","cw","ccw"].map(i=>`<option value=${i} ${i==a.wrapping?"selected":""}>${i}</option>`).join("")}
</select>
`).join("")}
<button onclick="addPulley(${t})">+</button>
<button onclick="removePulley(${t})">-</button>
Fixed end:
<select name="p3" onchange="updateConstraint(this, 'rope', ${t}, 'p3')">

${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p3?"selected":""}>P ${a+1}</option>`).join("")}
</select>
<button class=delete onclick="deleteConstraint('rope', ${t})">X</button>
<input type="checkbox" oninput="window.data.constraints.rope[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rope[t].oneway?"checked":""}></input>
`);o.addEventListener("mouseenter",()=>{window.data.constraints[e][t].hovered=!0,$()}),o.addEventListener("mouseleave",()=>{window.data.constraints[e][t].hovered=!1,$()}),document.getElementById("constraintsControl").appendChild(o)}let E=null;function W(e,t){var o=window.data.particles.findIndex(a=>{const n=Math.sqrt((a.x-e)**2+(a.y-t)**2),i=Math.cbrt(a.mass)*10;return n<i});return o==-1&&(o=window.data.particles.findIndex(a=>{const n=Math.sqrt((a.x-e)**2+(a.y-t)**2),i=15+Math.cbrt(a.mass)*10;return n<i})),o}u.addEventListener("mousedown",function(e){const t=u.getBoundingClientRect(),o=u.width/t.width,a=u.height/t.height,n=(e.clientX-t.left)*o,i=(e.clientY-t.top)*a,r=W(n,i);r!==-1?(E=r,u.style.cursor="move"):(startX=e.clientX-u.offsetLeft,startY=e.clientY-u.offsetTop)});u.addEventListener("mousemove",function(e){if(E!==null){const t=u.getBoundingClientRect(),o=u.width/t.width,a=u.height/t.height,n=(e.clientX-t.left)*o,i=(e.clientY-t.top)*a;window.data.particles[E].x=n,window.data.particles[E].y=i,$()}});u.addEventListener("mouseup",function(e){E!==null&&(g(),E=null,u.style.cursor="default")});u.addEventListener("mouseleave",function(e){E!==null&&(g(),E=null,u.style.cursor="default")});function K(){localStorage.setItem("mechanismData",JSON.stringify(window.data))}function G(){const e=localStorage.getItem("mechanismData");if(e){window.data=JSON.parse(e);try{g()}catch{N({value:"Hinged Counterweight"})}}else N({value:"Hinged Counterweight"})}window.addEventListener("resize",q);window.onload=()=>{G(),q(),fetch("https://apj.hgreer.com/jstreb",{method:"GET",cache:"no-store",mode:"no-cors"})};var Q={"Hinged Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":588,"y":440.7,"mass":10},{"x":668,"y":673.6,"mass":1},{"x":586,"y":533.7,"mass":100}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Fixed Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":668,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Floating Arm Trebuchet":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":487.0,"y":517.0,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":589,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',F2k:'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.6,"duration":35,"particles":[{"x":454,"y":516,"mass":1},{"x":436.6,"y":513.0,"mass":4},{"x":560.3,"y":211.5,"mass":100},{"x":652.9,"y":621.8,"mass":1}],"constraints":{"rod":[{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":1,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":0,"normal":{"x":0,"y":1}}],"colinear":[],"f2k":[{"reference":1,"slider":0,"base":2}],"rope":[]}}',"Floating Arm Whipper (NASAW)":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":37,"particles":[{"x":496.3,"y":477.6,"mass":1},{"x":677.5,"y":471.0,"mass":4},{"x":468.0,"y":453.5,"mass":10},{"x":557.0,"y":431.8,"mass":1},{"x":563.0,"y":340.7,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":4,"normal":{"x":0.6,"y":0}}],"colinear":[]}}',Whipper:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3,"duration":60,"particles":[{"x":536,"y":472.7,"mass":1},{"x":759,"y":451,"mass":4},{"x":483,"y":498,"mass":10},{"x":551,"y":434,"mass":1},{"x":560,"y":368,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":0}}]}}',Fiffer:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":20,"particles":[{"x":536,"y":472.7,"mass":1},{"x":484,"y":656,"mass":4},{"x":504,"y":433,"mass":10},{"x":644,"y":661,"mass":1},{"x":653,"y":451,"mass":10},{"x":749,"y":428,"mass":1},{"x":749,"y":483,"mass":500},{"x":566,"y":505,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":7,"p2":6},{"p1":6,"p2":4},{"p1":4,"p2":5}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":7,"normal":{"x":0.7,"y":1}},{"p":7,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0.7,"y":1}}]}}',"Floating Arm King Arthur":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":40,"particles":[{"x":536,"y":472.7,"mass":1},{"x":527,"y":610,"mass":4},{"x":534,"y":418,"mass":10},{"x":698,"y":608,"mass":1},{"x":560,"y":331,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":-0.5,"y":0},"oneway":true},{"p":1,"normal":{"x":0.7,"y":0},"oneway":true},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Launch Ness Monster":'{"projectile":3,"mainaxle":2,"armtip":1,"axleheight":8,"timestep":0.3,"duration":80,"particles":[{"x":600.7,"y":746.2,"mass":10},{"x":559.1,"y":774.0,"mass":4},{"x":660.2,"y":530.0,"mass":100},{"x":703.9,"y":796.7,"mass":1},{"x":810,"y":530,"mass":10},{"x":552,"y":500,"mass":10},{"x":458,"y":666,"mass":10},{"x":886.1,"y":662.4,"mass":10}],"constraints":{"rod":[{"p1":2,"p2":1},{"p1":3,"p2":1,},{"p1":6,"p2":5},{"p1":5,"p2":2},{"p1":4,"p2":2},{"p1":4,"p2":7},{"p1":5,"p2":4}],"slider":[{"p":0,"normal":{"x":1,"y":2.1}},{"p":0,"normal":{"x":-0.6,"y":1.6}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":6,"normal":{"x":0.6,"y":1}},{"p":6,"normal":{"x":0,"y":1}},{"p":7,"normal":{"x":1,"y":1}},{"p":7,"normal":{"x":0,"y":1}}],"colinear":[{"reference":1,"slider":0,"base":2}]}}',"Pulley Sling":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":35,"particles":[{"x":546.3,"y":584.3,"mass":1},{"x":285.6,"y":791.6,"mass":4},{"x":560.6,"y":481.2,"mass":10},{"x":1000.9,"y":742.8,"mass":1},{"x":645.5,"y":541.0,"mass":500},{"x":72.7,"y":730.2,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":5,"normal":{"x":1,"y":1}},{"p":5,"normal":{"x":0,"y":1}}],"colinear":[],"rope":[{"p1":5,"pulleys":[{"idx":1,"wrapping":"both"}],"p3":3}]}}'};let L=!1;var Y=0;async function ke(){if(L){L=!1,document.getElementById("optimize").innerText="Optimize",console.log(Y);return}document.getElementById("optimize").innerText="Stop",L=!0;for(var e=500,t=e,o=40;L;){Y+=1;var a=+document.getElementById("range").innerText,n=JSON.stringify(window.data);for(var i of window.data.particles)Math.random()>.5&&(i.x=i.x+o*(.5-Math.random()),i.y=i.y+o*(.5-Math.random()));var[r,s]=U();t%20==0&&await he();var l=s;l>a?(t=e,$()):(window.data=JSON.parse(n),t-=1,t==0&&(t=e,o*=.6))}$()}function Ie(){const e=new Blob([JSON.stringify(window.data)],{type:"application/json"}),t=prompt("Enter a filename for your window.data:","window.data.json");if(!t){alert("Save cancelled.");return}const o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function Le(){const e=document.createElement("input");e.type="file",e.onchange=t=>{console.log("asf");const o=t.target.files[0],a=new FileReader;a.onload=n=>{try{window.data=JSON.parse(n.target.result),g()}catch{alert("Error parsing JSON!")}},a.readAsText(o)},document.body.appendChild(e),e.click(),document.body.removeChild(e)}window.doAnimate=ve;window.terminate=F;window.drawMechanism=$;window.createParticle=ye;window.updateParticle=ge;window.deleteParticle=xe;window.createConstraint=be;window.updateConstraint=Me;window.deleteConstraint=_e;window.resizeCanvas=q;window.updateUI=g;window.loadPreset=N;window.createParticleControlBox=J;window.constraintExists=T;window.createConstraintControlBox=M;window.getParticleAtPosition=W;window.saveMechanism=K;window.loadMechanism=G;window.optimize=ke;window.save=Ie;window.load=Le;window.updatePulley=$e;window.updatePulleyDirection=Ce;window.addPulley=Pe;window.removePulley=Ee;
