(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();function V(e,t){const o=e.length,a=e[0].length,n=new Array(o).fill(0).map(()=>new Array(o));for(let l=0;l<o;l++){var i=e[l];for(let c=0;c<o;c++){var s=0,r=t[c];for(let u=0;u<a;u++)s+=i[u]*r[u];n[l][c]=s}}return n}function q(e,t){const o=e.length,a=e[0].length,n=new Array(o).fill(0).map(()=>new Array(a));for(let i=0;i<o;i++){let s=n[i],r=e[i];for(let l=0;l<a;l++)s[l]=r[l]/t[l]}return n}function P(e,t){const o=new Array(t.length);for(var a=0;a<t.length;a++)o[a]=t[a]*e;return o}function k(e){const t=new Array(e[0].length);for(var o=0;o<e[0].length;o++){for(var a=0,n=0;n<e.length;n++)a+=e[n][o];t[o]=a}return t}function $(e,t){return[e[0]-t[0],e[1]-t[1]]}function Z(e,t){return new Array(e.length).fill(0).map((o,a)=>e[a]-t[a])}function ee(e,t){const o=e.length,a=e[0].length,n=t.length,i=t[0].length;a!=n&&(console.log(a),console.log(n),assert(a==n));const s=new Array(o).fill(0).map(()=>new Array(i).fill(0));for(let r=0;r<o;r++)for(let l=0;l<i;l++)for(let c=0;c<a;c++)s[r][l]+=e[r][c]*t[c][l];return s}function te(e,t){const o=e.length;for(let n=0;n<o;n++){let i=Math.abs(e[n][n]),s=n;for(let c=n+1;c<o;c++)Math.abs(e[c][n])>i&&(i=Math.abs(e[c][n]),s=c);const r=e[s];e[s]=e[n],e[n]=r;const l=t[s];t[s]=t[n],t[n]=l;for(let c=n+1;c<o;c++){const u=-e[c][n]/e[n][n];for(let w=n;w<o;w++)n===w?e[c][w]=0:e[c][w]+=u*e[n][w];t[c]+=u*t[n]}}const a=new Array(o).fill(0);for(let n=o-1;n>-1;n--){a[n]=t[n]/e[n][n];for(let i=n-1;i>-1;i--)t[i]-=e[i][n]*a[n]}return a}function T(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function D(e,t){return e[0]*t[1]-e[1]*t[0]}function p(e,t){return[e[2*t],e[2*t+1]]}function x(e,t,o){e[2*o]=t[0],e[2*o+1]=t[1]}function B(e,t,o){this.p1=e,this.p2=t,this.oneway=o}function A(e,t,o){this.p1=e,this.p2=t,this.p3=o}function N(e,t,o){this.reference=e,this.slide=t,this.base=o,this.fatmode=!1}function O(e,t,o,a){this.reference=e,this.slide=t,this.base=o,this.oneway=a}function z(e,t,o){this.p=e,this.n=T(t),this.oneway=o}function ae(e,t,o,a){this.forces=Array(t.length).fill([0,-1]).flat(),this.constraints=e,this.masses=t.flatMap(n=>[n,n]),this.positions=o,this.velocities=a}function X(e,t,o,a,n){var i=Date.now();let s=[],r=[],l=[];for(var c of e)s.push(c.mass),r.push(c.x),r.push(c.y);for(var u of t.rod)l.push(new B(u.p1,u.p2,u.oneway));for(var w of t.slider)l.push(new z(w.p,[w.normal.x,w.normal.y],w.oneway));for(var m of t.colinear)l.push(new O(m.reference,m.slider,m.base,m.oneway));for(var v of t.f2k)l.push(new N(v.reference,v.slider,v.base));for(var h of t.rope)l.push(new A(h.p1,h.p2,h.p3));var y=new ae(l,s,r,new Array(r.length).fill(0));y.terminate=n;let C=y.positions.concat(y.velocities),S=ne(y,C,o,a);var j=Date.now();return document.getElementById("simtime").innerText=j-i,S}function ne(e,t,o,a){for(var n=t,i=0,s=o,r=[],l=!1;i<a&&!l;){i+=s;var[c,m]=E(e,n),[u,m]=E(e,k([n,P(s/2,c)])),[w,m]=E(e,k([n,P(s/2,u)])),[v,l]=E(e,k([n,P(s,w)]));n=k([n,P(s/6,k([c,P(2,u),P(2,w),v]))]),r.push(n)}return r}function oe(e){var t=e.constraints.map(r=>{if(r instanceof B)return ie(r,e);if(r instanceof z)return re(r,e);if(r instanceof O)return pe(r,e);if(r instanceof N)return ue(r,e);if(r instanceof A)return le(r,e)}),o=q(t,e.masses);o=V(o,t);var a=e.constraints.map(r=>{if(r instanceof B)return se(r,e);if(r instanceof z)return de(r,e);if(r instanceof O)return we(r,e);if(r instanceof N)return fe(r,e);if(r instanceof A)return ce(r,e)});let n=te(o,a),i=Z(q(ee([n],t),e.masses)[0],e.forces);for(var s=0;s<n.length;s++)if(n[s]>0&&e.constraints[s].oneway===!0){e.constraints.splice(s,1);break}return[i,!1]}function E(e,t){e.positions=t.slice(0,e.positions.length),e.velocities=t.slice(e.positions.length,t.length);let[o,a]=oe(e);if(e.terminate(t)){for(var n=window.data.projectile,i=0;i<e.constraints.length;i++)if(e.constraints[i].p1===n||e.constraints[i].p2===n||e.constraints[i].p3===n){e.constraints.splice(i,1);break}}return[e.velocities.concat(o),!1]}function ie(e,t){let o=T($(p(t.positions,e.p1),p(t.positions,e.p2))),a=new Array(t.positions.length).fill(0);return x(a,o,e.p2),x(a,[-o[0],-o[1]],e.p1),a}function re(e,t){let o=new Array(t.positions.length).fill(0);return x(o,e.n,e.p),o}function se(e,t){let o=$(p(t.positions,e.p1),p(t.positions,e.p2)),a=$(p(t.velocities,e.p1),p(t.velocities,e.p2)),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]);return(a[0]*a[0]+a[1]*a[1])/n}function le(e,t){let o=T($(p(t.positions,e.p1),p(t.positions,e.p2))),a=T($(p(t.positions,e.p2),p(t.positions,e.p3))),n=new Array(t.positions.length).fill(0);return x(n,[-o[0],-o[1]],e.p1),x(n,$(o,a),e.p2),x(n,a,e.p3),n}function ce(e,t){let o=$(p(t.positions,e.p1),p(t.positions,e.p2)),a=$(p(t.velocities,e.p1),p(t.velocities,e.p2)),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]),i=$(p(t.positions,e.p2),p(t.positions,e.p3)),s=$(p(t.velocities,e.p2),p(t.velocities,e.p3)),r=Math.sqrt(i[0]*i[0]+i[1]*i[1]);return Math.pow(D(o,a),2)/(n*n*n)+Math.pow(D(i,s),2)/(r*r*r)}function de(e,t){var o=p(t.forces,e.p);return e.n[0]*o[0]+e.n[1]*o[1]}function pe(e,t){var[o,a]=p(t.positions,e.slide);p(t.velocities,e.slide);var[n,i]=p(t.positions,e.reference);p(t.velocities,e.reference);var[s,r]=p(t.positions,e.base);p(t.velocities,e.base),o=o-s,a=a-r,n=n-s,i=i-r;var l=Math.sqrt(n*n+i*i),c=l*l*l,u=-i/l,w=n/l,m=(o*n*i+a*i*i)/c,v=-(o*n*n+n*a*i)/c,h=-u-m,y=-w-v;let C=new Array(t.positions.length).fill(0);return x(C,[u,w],e.slide),x(C,[m,v],e.reference),x(C,[h,y],e.base),C}function we(e,t){var[o,a]=p(t.positions,e.slide),[n,i]=p(t.velocities,e.slide),[s,r]=p(t.positions,e.reference),[l,c]=p(t.velocities,e.reference),[u,w]=p(t.positions,e.base),[m,v]=p(t.velocities,e.base);o=o-u,a=a-w,n=n-m,i=i-v,s=s-u,r=r-w,l=l-m,c=c-v;var h=Math.sqrt(s*s+r*r),y=(2*l*o*s*s-2*n*s*s*s-c*s*s*a+3*c*o*s*r-2*i*s*s*r+3*l*s*a*r-l*o*r*r-2*n*s*r*r+2*c*a*r*r-2*i*r*r*r)*(c*s-l*r)/(h*h*h*h*h);return-y}function ue(e,t){var[o,a]=p(t.positions,e.slide);p(t.velocities,e.slide);var[n,i]=p(t.positions,e.reference);p(t.velocities,e.reference);var[s,r]=p(t.positions,e.base);p(t.velocities,e.base),o=o-s,a=a-r,n=n-s,i=i-r;let l=new Array(t.positions.length).fill(0);if(i<0){if(!e.fatmode){var c=o,u=n-o;e.ratio=c/u}e.fatmode=!0}if(e.fatmode)return x(l,[0,1],e.base),x(l,[0,e.ratio],e.reference),l;var w=Math.sqrt(n*n+i*i),m=w*w*w,v=-i/w,h=n/w,y=(o*n*i+a*i*i)/m,C=-(o*n*n+n*a*i)/m,S=-v-y,j=-h-C;return x(l,[v,h],e.slide),x(l,[y,C],e.reference),x(l,[S,j],e.base),l}function fe(e,t){if(e.fatmode)return-1-e.ratio;var[o,a]=p(t.positions,e.slide),[n,i]=p(t.velocities,e.slide),[s,r]=p(t.positions,e.reference),[l,c]=p(t.velocities,e.reference),[u,w]=p(t.positions,e.base),[m,v]=p(t.velocities,e.base);o=o-u,a=a-w,n=n-m,i=i-v,s=s-u,r=r-w,l=l-m,c=c-v;var h=Math.sqrt(s*s+r*r),y=(2*l*o*s*s-2*n*s*s*s-c*s*s*a+3*c*o*s*r-2*i*s*s*r+3*l*s*a*r-l*o*r*r-2*n*s*r*r+2*c*a*r*r-2*i*r*r*r)*(c*s-l*r)/(h*h*h*h*h);return-y}const f=document.getElementById("mechanism"),d=f.getContext("2d");window.data={duration:50,timestep:1,projectile:3,mainaxle:0,armtip:1,axleheight:8,particles:[{x:100,y:100,mass:1,hovered:!1}],constraints:{rod:[],slider:[]}};async function he(){return new Promise(e=>{setTimeout(()=>{e()},1)})}async function me(){await new Promise(e=>{requestAnimationFrame(()=>{e()})})}async function ve(){if(window.data.timestep!=0){var e=JSON.stringify(window.data),t=X(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,F);window.data.timestep=0;for(var o of[window.data.constraints.rod,window.data.constraints.slider])for(var a=o.length,n=0;n<a;n++)o[n].oneway&&(o.splice(n,1),n-=1,a-=1);for(var i of t){for(var n=0;n<window.data.particles.length;n++)window.data.particles[n].x=i[2*n],window.data.particles[n].y=i[2*n+1];g(),await me()}window.data=JSON.parse(e),g()}}function F(e){e[2*window.data.armtip]-e[2*window.data.projectile],e[2*window.data.armtip+1]-e[2*window.data.projectile+1],e[2*window.data.armtip]-e[2*window.data.mainaxle],e[2*window.data.armtip+1]-e[2*window.data.mainaxle+1];var t=e[2*window.data.projectile+2*window.data.particles.length],o=e[2*window.data.projectile+2*window.data.particles.length+1];return t>40&&o>-15}function H(){const e=X(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,F);var t=-window.data.particles[window.data.mainaxle].y,o=-window.data.particles[window.data.mainaxle].y,a=0;for(var n of e){for(var i=0;i<window.data.particles.length;i++)n[2*i]<2e3&&(o=Math.min(o,-n[2*i+1])),t=Math.max(t,-n[2*window.data.mainaxle+1]);a=Math.max(a,2*Math.max(0,-n[2*window.data.particles.length+2*window.data.projectile+1])*n[2*window.data.particles.length+2*window.data.projectile])}var s=t-o,r=Math.sqrt(Math.pow(window.data.particles[window.data.armtip].x-window.data.particles[window.data.mainaxle].x,2)+Math.pow(window.data.particles[window.data.armtip].y-window.data.particles[window.data.projectile].y,2));return a=a/Math.max(s,.75*r)*window.data.axleheight,[e,a]}function g(){if(K(),d.save(),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,f.width,f.height),d.restore(),d.setTransform(1,0,0,1,0,0),window.data.particles.length>1&&window.data.constraints.rod.length+window.data.constraints.slider.length>1&&window.data.timestep>0&&typeof window.data.timestep=="number"){var[e,t]=H();document.getElementById("range").innerText=t,e.forEach(o=>{for(let a=0;a<window.data.constraints.rod.length;a++)if(window.data.constraints.rod[a].oneway!=!0){const n=window.data.constraints.rod[a],i=n.p1*2,s=n.p2*2;d.beginPath(),d.moveTo(o[i],o[i+1]),d.lineTo(o[s],o[s+1]),d.strokeStyle="rgba(255, 0, 0, 0.2)",d.stroke()}for(let a=0;a<window.data.constraints.rope.length;a++)if(window.data.constraints.rope[a].oneway!=!0){const n=window.data.constraints.rope[a],i=n.p1*2,s=n.p2*2,r=n.p3*2;d.beginPath(),d.moveTo(o[i],o[i+1]),d.lineTo(o[s],o[s+1]),d.lineTo(o[r],o[r+1]),d.strokeStyle="rgba(255, 0, 0, 0.2)",d.stroke()}}),d.strokeStyle="black"}window.data.particles.forEach((o,a)=>{const n=Math.cbrt(o.mass)*4;d.beginPath(),d.arc(o.x,o.y,n,0,Math.PI*2),d.fillStyle=o.hovered?"yellow":"black",d.strokeStyle="black",d.fill(),d.stroke(),d.font="18px Arial",d.textAlign="center",d.textBaseline="middle",d.fillStyle="black",d.fillText(`P${a+1}`,o.x,o.y-n-10)}),d.lineWidth=3,window.data.constraints.rod.forEach(o=>{const a=window.data.particles[o.p1],n=window.data.particles[o.p2];d.beginPath(),d.moveTo(a.x,a.y),d.lineTo(n.x,n.y),d.strokeStyle=o.hovered?"blue":"black",d.stroke()}),window.data.constraints.rope.forEach(o=>{const a=window.data.particles[o.p1],n=window.data.particles[o.p2],i=window.data.particles[o.p3];d.setLineDash([8,8]),d.beginPath(),d.moveTo(a.x,a.y),d.lineTo(n.x,n.y),d.lineTo(i.x,i.y),d.strokeStyle=o.hovered?"blue":"black",d.stroke(),d.setLineDash([])}),window.data.constraints.slider.forEach(o=>{const a=window.data.particles[o.p],n=40,i=Math.atan2(o.normal.y,o.normal.x)+Math.PI/2;d.beginPath(),d.moveTo(a.x-n*Math.cos(i),a.y-n*Math.sin(i)),d.lineTo(a.x+n*Math.cos(i),a.y+n*Math.sin(i)),d.strokeStyle=o.hovered?"red":"black",d.stroke()}),window.data.constraints.colinear.concat(window.data.constraints.f2k).forEach(o=>{const a=window.data.particles[o.base],n=window.data.particles[o.reference],i=window.data.particles[o.slider],s=Math.sqrt((a.x-n.x)*(a.x-n.x)+(a.y-n.y)*(a.y-n.y)),r=(a.x-n.x)/s,l=(a.y-n.y)/s,c=Math.abs(r*(a.y-i.y)-l*(a.x-i.x));d.beginPath(),d.arc(i.x,i.y,c,0,Math.PI*2),d.strokeStyle="grey",d.stroke()}),d.lineWidth=1}function xe(){const e={x:100,y:100,mass:1,hovered:!1};window.data.particles.push(e),b()}function ye(e,t,o){window.data.particles[e][t]=Number(o),g()}function ge(e){window.data.particles.splice(e,1),b()}function be(e){window.data.constraints[e].length;let t={};if(e==="rod"){if(window.data.particles.length<2){alert("At least two particles are required to create a rod constraint.");return}var o=[];for(let a=0;a<window.data.particles.length;a++)for(let n=0;n<window.data.particles.length;n++)L(a,n)||o.push([a,n]);t={p1:o[0][0],p2:o[0][1],hovered:!1},window.data.constraints.rod.push(t)}else if(e==="slider"){if(window.data.particles.length<1){alert("At least one particle is required to create a slider constraint.");return}t={p:0,normal:{x:0,y:1},hovered:!1},window.data.constraints.slider.push(t)}else if(e==="colinear")t={reference:0,slider:1,base:2},window.data.constraints.colinear.push(t);else if(e==="f2k")t={reference:0,slider:1,base:2},window.data.constraints.f2k.push(t);else if(e==="rope")t={p1:0,p2:1,p3:2},window.data.constraints.rope.push(t);else{console.error("Unknown constraint type:",e);return}b()}function $e(e,t,o,a){const n=a.includes("normal")?parseFloat(e.value):parseInt(e.value),i=window.data.constraints[t][o];a==="p1"||a==="p2"||a==="p"?(i[a]=n,b()):a==="normalX"||a==="normalY"?(i.normal[a.slice(-1).toLowerCase()]=n,g()):(i[a]=n,b())}function Ce(e,t){window.data.constraints[e].splice(t,1),b()}function R(){var e=600,t=600,o=2;f.width=e*o,f.height=t*o,f.style.width=e+"px",f.style.height=t+"px",b()}function b(){g(),document.getElementById("timestep").value=window.data.timestep,document.getElementById("duration").value=window.data.duration;const e=document.getElementById("particlesControl");for(;e.children.length>1;)e.removeChild(e.lastChild);window.data.particles.forEach((l,c)=>J(c));const t=document.getElementById("constraintsControl");for(;t.children.length>5;)t.removeChild(t.lastChild);window.data.constraints.rod.forEach((l,c)=>_("rod",c)),window.data.constraints.slider.forEach((l,c)=>_("slider",c)),window.data.constraints.colinear.forEach((l,c)=>_("colinear",c)),window.data.constraints.f2k.forEach((l,c)=>_("f2k",c)),window.data.constraints.rope.forEach((l,c)=>_("rope",c));const o=document.getElementById("presets");for(;o.children.length>0;)o.removeChild(o.lastChild);const a=document.createElement("option");a.selected="true",a.innerHTML="Presets",o.appendChild(a);for(var n of Object.keys(Q)){const l=document.createElement("option");l.innerHTML=n,l.value=n,o.appendChild(l)}for(var i of["armtip","projectile","mainaxle"]){for(var s=document.getElementById(i);s.children.length>0;)s.removeChild(s.lastChild);for(var r=0;r<window.data.particles.length;r++){const l=document.createElement("option");l.selected=window.data[i]==r,l.innerHTML=`P ${r+1}`,l.value=r,s.appendChild(l)}}document.getElementById("axleheight").value=window.data.axleheight}function Y(e){window.data=JSON.parse(Q[e.value]),window.data.constraints.colinear===void 0&&(window.data.constraints.colinear=[]),window.data.constraints.f2k===void 0&&(window.data.constraints.f2k=[]),window.data.constraints.rope===void 0&&(window.data.constraints.rope=[]),b()}function J(e){const t=document.createElement("div");t.className="control-box",t.innerHTML=`
                <label>Mass: <input type="text" min="1" max="500" value="${window.data.particles[e].mass}" oninput="updateParticle(${e}, 'mass', this.value)"></label>
                <label>X: <input type="text" min="0" max="${f.width}" value="${window.data.particles[e].x}" oninput="updateParticle(${e}, 'x', this.value)"></label>
                <label>Y: <input type="text" min="0" max="${f.height}" value="${window.data.particles[e].y}" oninput="updateParticle(${e}, 'y', this.value)"></label>
                <button onclick="deleteParticle(${e})">X</button>
              `,t.addEventListener("mouseenter",()=>{window.data.particles[e].hovered=!0,g()}),t.addEventListener("mouseleave",()=>{window.data.particles[e].hovered=!1,g()}),document.getElementById("particlesControl").appendChild(t)}function L(e,t){if(e==t)return!0;for(var o of window.data.constraints.rod)if(o.p1==e&&o.p2==t||o.p1==t&&o.p2==e||e==t)return!0;return!1}function _(e,t){const o=document.createElement("div");if(o.className="control-box",o.dataset.type=e,o.dataset.index=t,e==="rod")o.innerHTML=`Rod
                    <select name="p1" onchange="updateConstraint(this, 'rod', ${t}, 'p1')">
            	   ${window.data.particles.map((a,n)=>n).filter(a=>!L(window.data.constraints.rod[t].p2,a)||a==window.data.constraints.rod[t].p1).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[t].p1?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                    <select name="p2" onchange="updateConstraint(this, 'rod', ${t}, 'p2')">
            	   ${window.data.particles.map((a,n)=>n).filter(a=>!L(window.data.constraints.rod[t].p1,a)||a==window.data.constraints.rod[t].p2).map(a=>`<option value="${a}" ${a===window.data.constraints.rod[t].p2?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                  <button onclick="deleteConstraint('rod', ${t})">Delete</button>
            			<input type="checkbox" oninput="window.data.constraints.rod[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rod[t].oneway?"checked":""}></input>
                `;else if(e==="slider"){const a=window.data.constraints.slider[t];o.innerHTML=`
                  <label>
            		Slider
                    <select name="p" onchange="updateConstraint(this, 'slider', ${t}, 'p')">
                      ${window.data.particles.map((n,i)=>`<option value="${i}" ${i===a.p?"selected":""}>P ${i+1}</option>`).join("")}
                    </select>
                  </label>
                  <label>Normal X: <input type="range" name="normalX" min="-1" max="1" step="0.1" value="${a.normal.x}" oninput="updateConstraint(this, 'slider', ${t}, 'normalX')"></label>
                  <label>Normal Y: <input type="range" name="normalY" min="-1" max="1" step="0.1" value="${a.normal.y}" oninput="updateConstraint(this, 'slider', ${t}, 'normalY')"></label>
                  <button onclick="deleteConstraint('slider', ${t})">Delete</button>
            			<input type="checkbox" oninput="window.data.constraints.slider[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.slider[t].oneway?"checked":""}></input>
                `}else e==="colinear"?o.innerHTML=`Roller Track1
                    <select name="reference" onchange="updateConstraint(this, 'colinear', ${t}, 'reference')">
            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Slide
                    <select name="slider" onchange="updateConstraint(this, 'colinear', ${t}, 'slider')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Track2
                    <select name="base" onchange="updateConstraint(this, 'colinear', ${t}, 'base')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.colinear[t].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                  <button onclick="deleteConstraint('colinear', ${t})">Delete</button>
            			<input type="checkbox" oninput="window.data.constraints.colinear[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.colinear[t].oneway?"checked":""}></input>
                `:e==="f2k"?o.innerHTML=`F2k Arm Tip
                    <select name="reference" onchange="updateConstraint(this, 'f2k', ${t}, 'reference')">
            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].reference?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Roller 
                    <select name="slider" onchange="updateConstraint(this, 'f2k', ${t}, 'slider')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].slider?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Arm Base
                    <select name="base" onchange="updateConstraint(this, 'f2k', ${t}, 'base')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.f2k[t].base?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                  <button onclick="deleteConstraint('f2k', ${t})">Delete</button>
            			<input type="checkbox" oninput="window.data.constraints.f2k[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.f2k[t].oneway?"checked":""}></input>
                `:e==="rope"&&(o.innerHTML=`Rope and pulley.
Fixed end:

                    <select name="p1" onchange="updateConstraint(this, 'rope', ${t}, 'p1')">
            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p1?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Pulley:
                    <select name="p2" onchange="updateConstraint(this, 'rope', ${t}, 'p2')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p2?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
		    Fixed end:
                    <select name="p3" onchange="updateConstraint(this, 'rope', ${t}, 'p3')">

            	   ${window.data.particles.map((a,n)=>n).map(a=>`<option value="${a}" ${a===window.data.constraints.rope[t].p3?"selected":""}>P ${a+1}</option>`).join("")}
                    </select>
                  <button onclick="deleteConstraint('rope', ${t})">Delete</button>
            			<input type="checkbox" oninput="window.data.constraints.rope[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rope[t].oneway?"checked":""}></input>
                `);o.addEventListener("mouseenter",()=>{window.data.constraints[e][t].hovered=!0,g()}),o.addEventListener("mouseleave",()=>{window.data.constraints[e][t].hovered=!1,g()}),document.getElementById("constraintsControl").appendChild(o)}let M=null;function W(e,t){return window.data.particles.findIndex(o=>{const a=Math.sqrt((o.x-e)**2+(o.y-t)**2),n=Math.cbrt(o.mass)*10;return a<n})}f.addEventListener("mousedown",function(e){const t=f.getBoundingClientRect(),o=f.width/t.width,a=f.height/t.height,n=(e.clientX-t.left)*o,i=(e.clientY-t.top)*a,s=W(n,i);s!==-1?(M=s,f.style.cursor="move"):(startX=e.clientX-f.offsetLeft,startY=e.clientY-f.offsetTop)});f.addEventListener("mousemove",function(e){if(M!==null){const t=f.getBoundingClientRect(),o=f.width/t.width,a=f.height/t.height,n=(e.clientX-t.left)*o,i=(e.clientY-t.top)*a;window.data.particles[M].x=n,window.data.particles[M].y=i,g()}});f.addEventListener("mouseup",function(e){M!==null&&(b(),M=null,f.style.cursor="default")});f.addEventListener("mouseleave",function(e){M!==null&&(b(),M=null,f.style.cursor="default")});function K(){localStorage.setItem("mechanismData",JSON.stringify(window.data))}function G(){localStorage.getItem("mechanismData"),Y({value:"Hinged Counterweight"})}window.addEventListener("resize",R);window.onload=()=>{G(),R()};var Q={"Hinged Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":588,"y":440.7,"mass":10},{"x":668,"y":673.6,"mass":1},{"x":586,"y":533.7,"mass":100}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Fixed Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":668,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Floating Arm Trebuchet":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":487.0,"y":517.0,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":589,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',F2k:'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.6,"duration":35,"particles":[{"x":454,"y":516,"mass":1},{"x":436.6,"y":513.0,"mass":4},{"x":560.3,"y":211.5,"mass":100},{"x":652.9,"y":621.8,"mass":1}],"constraints":{"rod":[{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":1,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":0,"normal":{"x":0,"y":1}}],"colinear":[],"f2k":[{"reference":1,"slider":0,"base":2}],"rope":[]}}',"Floating Arm Whipper (NASAW)":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":37,"particles":[{"x":496.3,"y":477.6,"mass":1},{"x":677.5,"y":471.0,"mass":4},{"x":468.0,"y":453.5,"mass":10},{"x":557.0,"y":431.8,"mass":1},{"x":563.0,"y":340.7,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":4,"normal":{"x":0.6,"y":0}}],"colinear":[]}}',Whipper:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3,"duration":60,"particles":[{"x":536,"y":472.7,"mass":1},{"x":759,"y":451,"mass":4},{"x":483,"y":498,"mass":10},{"x":551,"y":434,"mass":1},{"x":560,"y":368,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":0}}]}}',Fiffer:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":20,"particles":[{"x":536,"y":472.7,"mass":1},{"x":484,"y":656,"mass":4},{"x":504,"y":433,"mass":10},{"x":644,"y":661,"mass":1},{"x":653,"y":451,"mass":10},{"x":749,"y":428,"mass":1},{"x":749,"y":483,"mass":500},{"x":566,"y":505,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":7,"p2":6},{"p1":6,"p2":4},{"p1":4,"p2":5}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":7,"normal":{"x":0.7,"y":1}},{"p":7,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0.7,"y":1}}]}}',"Floating Arm King Arthur":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":40,"particles":[{"x":536,"y":472.7,"mass":1},{"x":527,"y":610,"mass":4},{"x":534,"y":418,"mass":10},{"x":698,"y":608,"mass":1},{"x":560,"y":331,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":-0.5,"y":0},"oneway":true},{"p":1,"normal":{"x":0.7,"y":0},"oneway":true},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Launch Ness Monster":'{"projectile":3,"mainaxle":2,"armtip":1,"axleheight":8,"timestep":0.3,"duration":80,"particles":[{"x":600.7,"y":746.2,"mass":10},{"x":559.1,"y":774.0,"mass":4},{"x":660.2,"y":530.0,"mass":100},{"x":703.9,"y":796.7,"mass":1},{"x":810,"y":530,"mass":10},{"x":552,"y":500,"mass":10},{"x":458,"y":666,"mass":10},{"x":886.1,"y":662.4,"mass":10}],"constraints":{"rod":[{"p1":2,"p2":1},{"p1":3,"p2":1,"hovered":true},{"p1":6,"p2":5},{"p1":5,"p2":2},{"p1":4,"p2":2},{"p1":4,"p2":7},{"p1":5,"p2":4}],"slider":[{"p":0,"normal":{"x":1,"y":2.1}},{"p":0,"normal":{"x":-0.6,"y":1.6}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":6,"normal":{"x":0.6,"y":1}},{"p":6,"normal":{"x":0,"y":1}},{"p":7,"normal":{"x":1,"y":1}},{"p":7,"normal":{"x":0,"y":1}}],"colinear":[{"reference":1,"slider":0,"base":2}]}}',"Pulley Sling":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":35,"particles":[{"x":546.3,"y":584.3,"mass":1},{"x":285.6,"y":791.6,"mass":4},{"x":560.6,"y":481.2,"mass":10},{"x":1000.9,"y":742.8,"mass":1},{"x":645.5,"y":541.0,"mass":500},{"x":72.7,"y":730.2,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1,"hovered":true},{"p1":0,"p2":2},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":5,"normal":{"x":1,"y":1}},{"p":5,"normal":{"x":0,"y":1}}],"colinear":[],"rope":[{"p1":5,"p2":1,"p3":3}]}}'};let I=!1;var U=0;async function Me(){if(I){I=!1,document.getElementById("optimize").innerText="Optimize",console.log(U);return}document.getElementById("optimize").innerText="Stop",I=!0;for(var e=500,t=e,o=40;I;){U+=1;var a=+document.getElementById("range").innerText,n=JSON.stringify(window.data);for(var i of window.data.particles)Math.random()>.5&&(i.x=i.x+o*(.5-Math.random()),i.y=i.y+o*(.5-Math.random()));var[s,r]=H();t%20==0&&await he();var l=r;l>a?(t=e,g()):(window.data=JSON.parse(n),t-=1,t==0&&(t=e,o*=.6))}g()}function Pe(){const e=new Blob([JSON.stringify(window.data)],{type:"application/json"}),t=prompt("Enter a filename for your window.data:","window.data.json");if(!t){alert("Save cancelled.");return}const o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function _e(){const e=document.createElement("input");e.type="file",e.onchange=t=>{console.log("asf");const o=t.target.files[0],a=new FileReader;a.onload=n=>{try{window.data=JSON.parse(n.target.result),b()}catch{alert("Error parsing JSON!")}},a.readAsText(o)},document.body.appendChild(e),e.click(),document.body.removeChild(e)}window.doAnimate=ve;window.terminate=F;window.drawMechanism=g;window.createParticle=xe;window.updateParticle=ye;window.deleteParticle=ge;window.createConstraint=be;window.updateConstraint=$e;window.deleteConstraint=Ce;window.resizeCanvas=R;window.updateUI=b;window.loadPreset=Y;window.createParticleControlBox=J;window.constraintExists=L;window.createConstraintControlBox=_;window.getParticleAtPosition=W;window.saveMechanism=K;window.loadMechanism=G;window.optimize=Me;window.save=Pe;window.load=_e;
