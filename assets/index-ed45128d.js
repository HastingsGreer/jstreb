(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();function R(e,t){const n=e.length,a=e[0].length,r=new Array(n).fill(0).map(()=>new Array(n));for(let f=0;f<n;f++){var l=e[f];for(let s=0;s<n;s++){var o=0,i=t[s];for(let p=0;p<a;p++)o+=l[p]*i[p];r[f][s]=o}}return r}function E(e,t){const n=e.length,a=e[0].length,r=new Array(n).fill(0).map(()=>new Array(a));for(let l=0;l<n;l++)for(let o=0;o<a;o++)r[l][o]=e[l][o]/t[o];return r}function x(e,t){const n=new Array(t.length);for(var a=0;a<t.length;a++)n[a]=t[a]*e;return n}function M(e){const t=new Array(e[0].length);for(var n=0;n<e[0].length;n++){for(var a=0,r=0;r<e.length;r++)a+=e[r][n];t[n]=a}return t}function w(e,t){return[e[0]-t[0],e[1]-t[1]]}function F(e,t){return new Array(e.length).fill(0).map((n,a)=>e[a]-t[a])}function I(e,t){const n=e.length,a=e[0].length,r=t.length,l=t[0].length;a!=r&&(console.log(a),console.log(r),assert(a==r));const o=new Array(n).fill(0).map(()=>new Array(l).fill(0));for(let i=0;i<n;i++)for(let f=0;f<l;f++)for(let s=0;s<a;s++)o[i][f]+=e[i][s]*t[s][f];return o}function T(e,t){const n=e.length;for(let r=0;r<n;r++){let l=Math.abs(e[r][r]),o=r;for(let s=r+1;s<n;s++)Math.abs(e[s][r])>l&&(l=Math.abs(e[s][r]),o=s);const i=e[o];e[o]=e[r],e[r]=i;const f=t[o];t[o]=t[r],t[r]=f;for(let s=r+1;s<n;s++){const p=-e[s][r]/e[r][r];for(let u=r;u<n;u++)r===u?e[s][u]=0:e[s][u]+=p*e[r][u];t[s]+=p*t[r]}}const a=new Array(n).fill(0);for(let r=n-1;r>-1;r--){a[r]=t[r]/e[r][r];for(let l=r-1;l>-1;l--)t[l]-=e[l][r]*a[r]}return a}function z(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function N(e,t){return e[0]*t[1]-e[1]*t[0]}function c(e,t){return[e[2*t],e[2*t+1]]}function g(e,t,n){e[2*n]=t[0],e[2*n+1]=t[1]}function A(e,t,n){this.p1=e,this.p2=t,this.oneway=n}function P(e,t,n){this.p1=e,this.p2=t,this.p3=n}function S(e,t,n){this.reference=e,this.slide=t,this.base=n,this.fatmode=!1}function j(e,t,n,a){this.reference=e,this.slide=t,this.base=n,this.oneway=a}function D(e,t,n){this.p=e,this.n=z(t),this.oneway=n}function B(e,t,n,a){this.forces=Array(t.length).fill([0,-1]).flat(),this.constraints=e,this.masses=t.flatMap(r=>[r,r]),this.positions=n,this.velocities=a}function C(e,t,n,a,r){var l=Date.now();let o=[],i=[],f=[];for(var s of e)o.push(s.mass),i.push(s.x),i.push(s.y);for(var p of t.rod)f.push(new A(p.p1,p.p2,p.oneway));for(var u of t.slider)f.push(new D(u.p,[u.normal.x,u.normal.y],u.oneway));for(var h of t.colinear)f.push(new j(h.reference,h.slider,h.base,h.oneway));for(var d of t.f2k)f.push(new S(d.reference,d.slider,d.base));for(var v of t.rope)f.push(new P(v.p1,v.p2,v.p3));var _=new B(f,o,i,new Array(i.length).fill(0));_.terminate=r;let b=_.positions.concat(_.velocities),O=K(_,b,n,a);var L=Date.now();return document.getElementById("simtime").innerText=L-l,O}function K(e,t,n,a){for(var r=t,l=0,o=n,i=[],f=!1;l<a&&!f;){l+=o;var[s,h]=q(e,r),[p,h]=q(e,M([r,x(o/2,s)])),[u,h]=q(e,M([r,x(o/2,p)])),[d,f]=q(e,M([r,x(o,u)]));r=M([r,x(o/6,M([s,x(2,p),x(2,u),d]))]),i.push(r)}return i}function G(e){var t=e.constraints.map(i=>{if(i instanceof A)return H(i,e);if(i instanceof D)return J(i,e);if(i instanceof j)return X(i,e);if(i instanceof S)return Z(i,e);if(i instanceof P)return U(i,e)}),n=E(t,e.masses);n=R(n,t);var a=e.constraints.map(i=>{if(i instanceof A)return Q(i,e);if(i instanceof D)return W(i,e);if(i instanceof j)return Y(i,e);if(i instanceof S)return $(i,e);if(i instanceof P)return V(i,e)});let r=T(n,a),l=F(E(I([r],t),e.masses)[0],e.forces);for(var o=0;o<r.length;o++)if(r[o]>0&&e.constraints[o].oneway===!0){e.constraints.splice(o,1);break}return[l,!1]}function q(e,t){e.positions=t.slice(0,e.positions.length),e.velocities=t.slice(e.positions.length,t.length);let[n,a]=G(e);if(e.terminate(t)){for(var r=0;r<e.constraints.length;r++)if(e.constraints[r].p1===3||e.constraints[r].p2===3||e.constraints[r].p3===3){e.constraints.splice(r,1);break}}return[e.velocities.concat(n),!1]}function H(e,t){let n=z(w(c(t.positions,e.p1),c(t.positions,e.p2))),a=new Array(t.positions.length).fill(0);return g(a,n,e.p2),g(a,[-n[0],-n[1]],e.p1),a}function J(e,t){let n=new Array(t.positions.length).fill(0);return g(n,e.n,e.p),n}function Q(e,t){let n=w(c(t.positions,e.p1),c(t.positions,e.p2)),a=w(c(t.velocities,e.p1),c(t.velocities,e.p2)),r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return(a[0]*a[0]+a[1]*a[1])/r}function U(e,t){let n=z(w(c(t.positions,e.p1),c(t.positions,e.p2))),a=z(w(c(t.positions,e.p2),c(t.positions,e.p3))),r=new Array(t.positions.length).fill(0);return g(r,[-n[0],-n[1]],e.p1),g(r,w(n,a),e.p2),g(r,a,e.p3),r}function V(e,t){let n=w(c(t.positions,e.p1),c(t.positions,e.p2)),a=w(c(t.velocities,e.p1),c(t.velocities,e.p2)),r=Math.sqrt(n[0]*n[0]+n[1]*n[1]),l=w(c(t.positions,e.p2),c(t.positions,e.p3)),o=w(c(t.velocities,e.p2),c(t.velocities,e.p3)),i=Math.sqrt(l[0]*l[0]+l[1]*l[1]);return Math.pow(N(n,a),2)/(r*r*r)+Math.pow(N(l,o),2)/(i*i*i)}function W(e,t){var n=c(t.forces,e.p);return e.n[0]*n[0]+e.n[1]*n[1]}function X(e,t){var[n,a]=c(t.positions,e.slide);c(t.velocities,e.slide);var[r,l]=c(t.positions,e.reference);c(t.velocities,e.reference);var[o,i]=c(t.positions,e.base);c(t.velocities,e.base),n=n-o,a=a-i,r=r-o,l=l-i;var f=Math.sqrt(r*r+l*l),s=f*f*f,p=-l/f,u=r/f,h=(n*r*l+a*l*l)/s,d=-(n*r*r+r*a*l)/s,v=-p-h,_=-u-d;let b=new Array(t.positions.length).fill(0);return g(b,[p,u],e.slide),g(b,[h,d],e.reference),g(b,[v,_],e.base),b}function Y(e,t){var[n,a]=c(t.positions,e.slide),[r,l]=c(t.velocities,e.slide),[o,i]=c(t.positions,e.reference),[f,s]=c(t.velocities,e.reference),[p,u]=c(t.positions,e.base),[h,d]=c(t.velocities,e.base);n=n-p,a=a-u,r=r-h,l=l-d,o=o-p,i=i-u,f=f-h,s=s-d;var v=Math.sqrt(o*o+i*i),_=(2*f*n*o*o-2*r*o*o*o-s*o*o*a+3*s*n*o*i-2*l*o*o*i+3*f*o*a*i-f*n*i*i-2*r*o*i*i+2*s*a*i*i-2*l*i*i*i)*(s*o-f*i)/(v*v*v*v*v);return-_}function Z(e,t){var[n,a]=c(t.positions,e.slide);c(t.velocities,e.slide);var[r,l]=c(t.positions,e.reference);c(t.velocities,e.reference);var[o,i]=c(t.positions,e.base);c(t.velocities,e.base),n=n-o,a=a-i,r=r-o,l=l-i;let f=new Array(t.positions.length).fill(0);if(l<0){if(!e.fatmode){var s=n,p=r-n;e.ratio=s/p}e.fatmode=!0}if(e.fatmode)return g(f,[0,1],e.base),g(f,[0,e.ratio],e.reference),f;var u=Math.sqrt(r*r+l*l),h=u*u*u,d=-l/u,v=r/u,_=(n*r*l+a*l*l)/h,b=-(n*r*r+r*a*l)/h,O=-d-_,L=-v-b;return g(f,[d,v],e.slide),g(f,[_,b],e.reference),g(f,[O,L],e.base),f}function $(e,t){if(e.fatmode)return-1-e.ratio;var[n,a]=c(t.positions,e.slide),[r,l]=c(t.velocities,e.slide),[o,i]=c(t.positions,e.reference),[f,s]=c(t.velocities,e.reference),[p,u]=c(t.positions,e.base),[h,d]=c(t.velocities,e.base);n=n-p,a=a-u,r=r-h,l=l-d,o=o-p,i=i-u,f=f-h,s=s-d;var v=Math.sqrt(o*o+i*i),_=(2*f*n*o*o-2*r*o*o*o-s*o*o*a+3*s*n*o*i-2*l*o*o*i+3*f*o*a*i-f*n*i*i-2*r*o*i*i+2*s*a*i*i-2*l*i*i*i)*(s*o-f*i)/(v*v*v*v*v);return-_}window.simulate=C;
