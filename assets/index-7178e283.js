(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();function Ce(e){let t=0;for(var a=0;a<e.length;a++)e[a]!=0&&(t=t+(1<<a));return t}function Ee(e,t){const a=e.length,n=new Array(a).fill(0).map(()=>new Array(a));let o=[];for(var r=0;r<e.length;r++)o[r]=Ce(e[r]);for(let d=0;d<a;d++){var i=e[d];for(let f=0;f<a;f++){var s=0,l=o[d]&o[f];if(l)for(var c=t[f];l;){var p=31-Math.clz32(l);l=l-(1<<p),s+=i[p]*c[p]}n[d][f]=s}}return n}function me(e,t){const a=e.length,n=e[0].length,o=new Array(a).fill(0).map(()=>new Array(n));for(let r=0;r<a;r++){let i=o[r],s=e[r];for(let l=0;l<n;l++)i[l]=s[l]/t[l]}return o}function L(e,t){return[e[0]-t[0],e[1]-t[1]]}function Pe(e,t){return new Array(e.length).fill(0).map((a,n)=>e[n]-t[n])}function Se(e,t){const a=e.length,n=e[0].length,o=t.length,r=t[0].length;n!=o&&(console.log(n),console.log(o),assert(n==o));const i=new Array(a).fill(0).map(()=>new Array(r).fill(0));for(let s=0;s<a;s++)for(let l=0;l<r;l++)for(let c=0;c<n;c++)i[s][l]+=e[s][c]*t[c][l];return i}function Ie(e,t){const a=e.length;for(let i=0;i<a;i++){let s=Math.abs(e[i][i]),l=i;for(let d=i+1;d<a;d++)Math.abs(e[d][i])>s&&(s=Math.abs(e[d][i]),l=d);const c=e[l];e[l]=e[i],e[i]=c;const p=t[l];t[l]=t[i],t[i]=p;var n=e[i];for(let d=i+1;d<a;d++){var o=e[d];const f=-o[i]/n[i];o[i]=0;for(let g=i+1;g<a;g++)o[g]+=f*n[g];t[d]+=f*t[i]}}const r=new Array(a).fill(0);for(let i=a-1;i>-1;i--){r[i]=t[i]/e[i][i];for(let s=i-1;s>-1;s--)t[s]-=e[s][i]*r[i]}return r}function Te(e){for(var t=0,a=0;a<e.length;a++)t=Math.max(Math.abs(e[a]),t);return t}function ve(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)a[n]=e[n]-t[n];return a}function y(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)a[n]=e[n]+t[n];return a}function m(e,t){if(Array.isArray(e)){var a=t;t=e,e=a}for(var n=new Array(t.length),o=0;o<t.length;o++)n[o]=e*t[o];return n}function de(e,t,a,n,o,r,i){this.x=e,this.y=t,this.f=a,this.ymid=n,this.iterations=o,this.events=i,this.message=r}de.prototype._at=function(v,a){function n(R){return R*R}var o=this,r=o.x,i=o.y,s=o.f,l=o.ymid;r.length;var c,p,d,f,g,x,v,$,A=.5,j,D,T;return c=r[a],p=r[a+1],f=i[a],g=i[a+1],$=p-c,d=c+A*$,x=l[a],j=ve(s[a],m(f,1/(c-d)+2/(c-p))),D=ve(s[a+1],m(g,1/(p-d)+2/(p-c))),T=[n(v-p)*(v-d)/n(c-p)/(c-d),n(v-c)*n(v-p)/n(c-d)/n(p-d),n(v-c)*(v-d)/n(p-c)/(p-d),(v-c)*n(v-p)*(v-d)/n(c-p)/(c-d),(v-p)*n(v-c)*(v-d)/n(c-p)/(p-d)],y(y(y(y(m(f,T[0]),m(x,T[1])),m(g,T[2])),m(j,T[3])),m(D,T[4]))};de.prototype.at=function(t){var a,n,o,r=Math.floor;if(typeof t!="number"){var i=t.length,s=Array(i);for(a=i-1;a!==-1;--a)s[a]=this.at(t[a]);return s}var l=this.x;for(a=0,n=l.length-1;n-a>1;)o=r(.5*(a+n)),l[o]<=t?a=o:n=o;return this._at(t,a)};function Le(e,t,a,n,o,r,i){typeof o>"u"&&(o=1e-6),typeof r>"u"&&(r=1e3);var s=[e],l=[a],c=[n(e,a)],p,d,f,g,x,v,$=[],A=1/5,j=[3/40,9/40],D=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],R=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],W=[35/384,0,500/1113,125/192,-2187/6784,11/84],Y=[.5*6025192743/30085553152,0,.5*51252292925/65400821598,.5*-2691868925/45128329728,.5*187940372067/1594534317056,.5*-1776094331/19743644256,.5*11237099/235043384],K=[1/5,3/10,4/5,8/9,1,1],J=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],_=0,V,O,u=(t-e)/10,Z=0,F,G,fe=Math.min,Me=Math.abs,he=Math.pow,ee=ee,X=X,te=te,M,S,H,I=new de(s,l,c,$,-1,"");for(typeof i=="function"&&(M=i(e,a));e<t&&Z<r;){if(++Z,e+u>t&&(u=t-e),p=n(e+K[0]*u,y(a,m(A*u,c[_]))),d=n(e+K[1]*u,y(y(a,m(j[0]*u,c[_])),m(j[1]*u,p))),f=n(e+K[2]*u,y(y(y(a,m(D[0]*u,c[_])),m(D[1]*u,p)),m(D[2]*u,d))),g=n(e+K[3]*u,y(y(y(y(a,m(T[0]*u,c[_])),m(T[1]*u,p)),m(T[2]*u,d)),m(T[3]*u,f))),x=n(e+K[4]*u,y(y(y(y(y(a,m(R[0]*u,c[_])),m(R[1]*u,p)),m(R[2]*u,d)),m(R[3]*u,f)),m(R[4]*u,g))),F=y(y(y(y(y(a,m(c[_],u*W[0])),m(d,u*W[2])),m(f,u*W[3])),m(g,u*W[4])),m(x,u*W[5])),v=n(e+u,F),V=y(y(y(y(y(m(c[_],u*J[0]),m(d,u*J[2])),m(f,u*J[3])),m(g,u*J[4])),m(x,u*J[5])),m(v,u*J[6])),typeof V=="number"?G=Me(V):G=Te(V),G>o){if(u=.2*u*he(o/G,.25),e+u===e){I.msg="Step size became too small";break}continue}if($[_]=y(y(y(y(y(y(a,m(c[_],u*Y[0])),m(d,u*Y[2])),m(f,u*Y[3])),m(g,u*Y[4])),m(x,u*Y[5])),m(v,u*Y[6])),++_,s[_]=e+u,l[_]=F,c[_]=v,typeof i=="function"){var ae,Q=e,B=e+.5*u,C;if(S=i(B,$[_-1]),H=te(X(M,0),X(0,S)),ee(H)||(Q=B,B=e+u,M=S,S=i(B,F),H=te(X(M,0),X(0,S))),ee(H)){for(var se,ne,oe=0,z=1,q=1;;){if(typeof M=="number")C=(q*S*Q-z*M*B)/(q*S-z*M);else for(C=B,O=M.length-1;O!==-1;--O)M[O]<0&&S[O]>0&&(C=fe(C,(q*S[O]*Q-z*M[O]*B)/(q*S[O]-z*M[O])));if(C<=Q||C>=B)break;ae=I._at(C,_-1),ne=i(C,ae),se=te(X(M,0),X(0,ne)),ee(se)?(B=C,S=ne,H=se,q=1,oe===-1?z*=.5:z=1,oe=-1):(Q=C,M=ne,z=1,oe===1?q*=.5:q=1,oe=1)}return F=I._at(.5*(e+C),_-1),I.f[_]=n(C,ae),I.x[_]=C,I.y[_]=ae,I.ymid[_-1]=F,I.events=H,I.iterations=Z,I}}e+=u,a=F,M=S,u=fe(.8*u*he(o/G,.25),4*u)}return I.iterations=Z,I}function pe(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}function le(e,t){return e[0]*t[1]-e[1]*t[0]}function h(e,t){return[e[2*t],e[2*t+1]]}function E(e,t,a){e[2*a]=t[0],e[2*a+1]=t[1]}function Ae(e,t,a){this.p1=e,this.p2=t,this.oneway=a,this.name="Rod"}function je(e,t,a){this.p1=e,this.p2=t,this.p3=a,this.name="Rope"}function Oe(e,t,a){this.reference=e,this.slide=t,this.base=a,this.fatmode=!1,this.name="F2k"}function Be(e,t,a,n){this.reference=e,this.slide=t,this.base=a,this.oneway=n,this.name="Colinear"}function Ne(e,t,a){this.p=e,this.n=pe(t),this.oneway=a,this.name="Slider"}function Re(e,t,a,n){this.forces=Array(t.length).fill([0,-1]).flat(),this.constraints=e,this.masses=t.flatMap(o=>[o,o]),this.positions=a,this.velocities=n}function Fe(e){let t={rod:[],slider:[],colinear:[],f2k:[],rope:[]};for(let a of e)switch(a.name){case"Rod":t.rod.push({p1:a.p1,p2:a.p2,oneway:a.oneway});break;case"Slider":t.slider.push({p:a.p,normal:{x:a.n[0],y:a.n[1]},oneway:a.oneway});break;case"Colinear":t.colinear.push({reference:a.reference,slider:a.slide,base:a.base,oneway:a.oneway});break;case"F2k":t.f2k.push({reference:a.reference,slider:a.slide,base:a.base});break;case"Rope":t.rope.push({p1:a.p1,pulleys:a.p2.filter(n=>n.wrapping!="cw_drop"&&n.wrapping!="ccw_drop"),p3:a.p3});break}return t}function ye(e,t,a,n,o){var r=Date.now();let i=[],s=[],l=[];for(var c of e)i.push(c.mass),s.push(c.x),s.push(c.y);for(var p of t.rod)l.push(new Ae(p.p1,p.p2,p.oneway));for(var d of t.slider)l.push(new Ne(d.p,[d.normal.x,d.normal.y],d.oneway));for(var f of t.colinear)l.push(new Be(f.reference,f.slider,f.base,f.oneway));for(var g of t.f2k)l.push(new Oe(g.reference,g.slider,g.base));for(var x of t.rope)l.push(new je(x.p1,x.pulleys.slice(),x.p3));var v=new Re(l,i,s,new Array(s.length).fill(0));v.terminate=o;let $=v.positions.concat(v.velocities),A=Xe(v,$,a,n);var j=Date.now();return document.getElementById("simtime").innerText=j-r,A}function Xe(e,t,a,n){for(var o=[],r=[],i=(p,d)=>{for(;p<o[o.length-1];){o.pop();var f=r.pop();e.constraints=JSON.parse(f),e.string_constraint=f}return o.push(p),e.string_constraint||(e.string_constraint=JSON.stringify(e.constraints)),r.push(e.string_constraint),qe(e,d)[0]},s=Le(0,n,t,i,1e-6,1e4),l=[],c=0;c<n;)l.push(s.at(c)),c+=a;return[l,[o,r]]}function ze(e){var t=e.constraints.map(s=>{if(s.name==="Rod")return De(s,e);if(s.name==="Slider")return Ye(s,e);if(s.name==="Colinear")return Ke(s,e);if(s.name==="F2k")return Qe(s,e);if(s.name==="Rope")return He(s,e)}),a=me(t,e.masses);a=Ee(a,t);var n=e.constraints.map(s=>{if(s.name==="Rod")return Je(s,e);if(s.name==="Slider")return We(s,e);if(s.name==="Colinear")return Ge(s,e);if(s.name==="F2k")return Ve(s,e);if(s.name==="Rope")return Ue(s,e)});let o=Ie(a,n),r=Pe(me(Se([o],t),e.masses)[0],e.forces);for(var i=0;i<o.length;i++)if(o[i]>0&&e.constraints[i].oneway===!0){e.constraints.splice(i,1),e.string_constraint=null;break}return[r,!1]}function qe(e,t){e.positions=t.slice(0,e.positions.length),e.velocities=t.slice(e.positions.length,t.length);let[a,n]=ze(e);if(e.terminate(t)){for(var o=window.data.projectile,r=0;r<e.constraints.length;r++)if(e.constraints[r].p1===o||e.constraints[r].p2===o||e.constraints[r].p3===o){e.constraints.splice(r,1),e.string_constraint=null;break}}return[e.velocities.concat(a),!1]}function De(e,t){let a=pe(L(h(t.positions,e.p1),h(t.positions,e.p2))),n=new Array(t.positions.length).fill(0);return E(n,a,e.p2),E(n,[-a[0],-a[1]],e.p1),n}function Ye(e,t){let a=new Array(t.positions.length).fill(0);return E(a,e.n,e.p),a}function Je(e,t){let a=L(h(t.positions,e.p1),h(t.positions,e.p2)),n=L(h(t.velocities,e.p1),h(t.velocities,e.p2)),o=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return(n[0]*n[0]+n[1]*n[1])/o}function He(e,t){var a=[];a.push(e.p1);for(var n of e.p2)a.push(n.idx);a.push(e.p3);for(var o=1;o<a.length-1;o++){var r=h(t.positions,a[o-1]),i=h(t.positions,a[o]),s=h(t.positions,a[o+1]),l=le(L(r,i),L(i,s));if(l>0&&e.p2[o-1].wrapping=="ccw_drop"||l<0&&e.p2[o-1].wrapping=="cw_drop"){e.p2[o-1].wrapping="both",t.string_constraint=null;break}}a=[],a.push(e.p1);for(var n of e.p2)n.wrapping!="ccw_drop"&&n.wrapping!="cw_drop"&&a.push(n.idx);a.push(e.p3);for(var o=1;o<a.length-1;o++){var r=h(t.positions,a[o-1]),i=h(t.positions,a[o]),s=h(t.positions,a[o+1]),l=le(L(r,i),L(i,s));if(l>0&&e.p2[o-1].wrapping=="ccw"||l<0&&e.p2[o-1].wrapping=="cw"){e.p2.splice(o-1,1),t.string_constraint=null;break}}a=[],a.push(e.p1);for(var n of e.p2)n.wrapping!="ccw_drop"&&n.wrapping!="cw_drop"&&a.push(n.idx);a.push(e.p3);let c=new Array(t.positions.length).fill(0);for(var o=0;o<a.length-1;o++){let d=a[o],f=a[o+1],g=pe(L(h(t.positions,d),h(t.positions,f))),x=h(c,d);E(c,L(x,g),d),E(c,g,f)}return c}function Ue(e,t){var a=0,n=[];n.push(e.p1);for(var o of e.p2)o.wrapping!="ccw_drop"&&o.wrapping!="cw_drop"&&n.push(o.idx);n.push(e.p3);for(var r=0;r<n.length-1;r++){let i=n[r],s=n[r+1],l=L(h(t.positions,i),h(t.positions,s)),c=L(h(t.velocities,i),h(t.velocities,s)),p=Math.sqrt(l[0]*l[0]+l[1]*l[1]);a+=Math.pow(le(l,c),2)/(p*p*p)}return a}function We(e,t){var a=h(t.forces,e.p);return e.n[0]*a[0]+e.n[1]*a[1]}function Ke(e,t){var[a,n]=h(t.positions,e.slide);h(t.velocities,e.slide);var[o,r]=h(t.positions,e.reference);h(t.velocities,e.reference);var[i,s]=h(t.positions,e.base);h(t.velocities,e.base),a=a-i,n=n-s,o=o-i,r=r-s;var l=Math.sqrt(o*o+r*r),c=l*l*l,p=-r/l,d=o/l,f=(a*o*r+n*r*r)/c,g=-(a*o*o+o*n*r)/c,x=-p-f,v=-d-g;let $=new Array(t.positions.length).fill(0);return E($,[p,d],e.slide),E($,[f,g],e.reference),E($,[x,v],e.base),$}function Ge(e,t){var[a,n]=h(t.positions,e.slide),[o,r]=h(t.velocities,e.slide),[i,s]=h(t.positions,e.reference),[l,c]=h(t.velocities,e.reference),[p,d]=h(t.positions,e.base),[f,g]=h(t.velocities,e.base);a=a-p,n=n-d,o=o-f,r=r-g,i=i-p,s=s-d,l=l-f,c=c-g;var x=Math.sqrt(i*i+s*s),v=i/x,$=s/x,A=(c*v-l*$)*(((2*l*a-c*n)*v*v+(c*a+l*n)*3*v*$+(2*c*n-l*a)*$*$)/(x*x)-2*(o*v+r*$)/x);return-A}function Qe(e,t){var[a,n]=h(t.positions,e.slide);h(t.velocities,e.slide);var[o,r]=h(t.positions,e.reference);h(t.velocities,e.reference);var[i,s]=h(t.positions,e.base);h(t.velocities,e.base),a=a-i,n=n-s,o=o-i,r=r-s;let l=new Array(t.positions.length).fill(0);if(r<0){if(!e.fatmode){var c=a,p=o-a;e.ratio=c/p}e.fatmode=!0,t.string_constraint=null}if(e.fatmode)return E(l,[0,1],e.base),E(l,[0,e.ratio],e.reference),l;var d=Math.sqrt(o*o+r*r),f=d*d*d,g=-r/d,x=o/d,v=(a*o*r+n*r*r)/f,$=-(a*o*o+o*n*r)/f,A=-g-v,j=-x-$;return E(l,[g,x],e.slide),E(l,[v,$],e.reference),E(l,[A,j],e.base),l}function Ve(e,t){if(e.fatmode)return-1-e.ratio;var[a,n]=h(t.positions,e.slide),[o,r]=h(t.velocities,e.slide),[i,s]=h(t.positions,e.reference),[l,c]=h(t.velocities,e.reference),[p,d]=h(t.positions,e.base),[f,g]=h(t.velocities,e.base);a=a-p,n=n-d,o=o-f,r=r-g,i=i-p,s=s-d,l=l-f,c=c-g;var x=Math.sqrt(i*i+s*s),v=(2*l*a*i*i-2*o*i*i*i-c*i*i*n+3*c*a*i*s-2*r*i*i*s+3*l*i*n*s-l*a*s*s-2*o*i*s*s+2*c*n*s*s-2*r*s*s*s)*(c*i-l*s)/(x*x*x*x*x);return-v}const b=document.getElementById("mechanism");b.addEventListener("touchstart",function(e){var t=e.touches[0],a=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});b.dispatchEvent(a)});b.addEventListener("touchend",function(e){var t=new MouseEvent("mouseup",{});b.dispatchEvent(t)});b.addEventListener("touchmove",function(e){if(!(e.touches.length>1)&&N!==null){e.preventDefault();var t=e.touches[0],a=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});b.dispatchEvent(a)}});const w=b.getContext("2d");window.data={duration:50,timestep:1,projectile:3,mainaxle:0,armtip:1,axleheight:8,particles:[{x:100,y:100,mass:1,hovered:!1}],constraints:{rod:[],slider:[]}};async function Ze(){return new Promise(e=>{setTimeout(()=>{e()},1)})}async function et(){await new Promise(e=>{requestAnimationFrame(()=>{e()})})}async function tt(){if(window.data.timestep!=0){var e=JSON.stringify(window.data),[t,a]=ye(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,we),n=window.data.timestep;window.data.timestep=0;var o=0,r=0;for(var i of t){for(;a[0][r+1]<o;)r+=1;o+=n;var s=JSON.parse(a[1][r]);window.data.constraints=Fe(s);for(var l=0;l<window.data.particles.length;l++)window.data.particles[l].x=i[2*l],window.data.particles[l].y=i[2*l+1];P(),await et()}window.data=JSON.parse(e),P()}}function we(e){e[2*window.data.armtip]-e[2*window.data.projectile],e[2*window.data.armtip+1]-e[2*window.data.projectile+1],e[2*window.data.armtip]-e[2*window.data.mainaxle],e[2*window.data.armtip+1]-e[2*window.data.mainaxle+1];var t=e[2*window.data.projectile+2*window.data.particles.length],a=e[2*window.data.projectile+2*window.data.particles.length+1];return t>40&&a>-15}function ge(){const[e,t]=ye(window.data.particles,window.data.constraints,window.data.timestep,window.data.duration,we);var a=-window.data.particles[window.data.mainaxle].y,n=-window.data.particles[window.data.mainaxle].y,o=0;for(var r of e){for(var i=0;i<window.data.particles.length;i++)r[2*i]<2e3&&(n=Math.min(n,-r[2*i+1])),a=Math.max(a,-r[2*window.data.mainaxle+1]);o=Math.max(o,2*Math.max(0,-r[2*window.data.particles.length+2*window.data.projectile+1])*r[2*window.data.particles.length+2*window.data.projectile])}var s=a-n,l=Math.sqrt(Math.pow(window.data.particles[window.data.armtip].x-window.data.particles[window.data.mainaxle].x,2)+Math.pow(window.data.particles[window.data.armtip].y-window.data.particles[window.data.projectile].y,2));return o=o/Math.max(s,.75*l)*window.data.axleheight,[e,o,t]}function P(){if($e(),w.save(),w.setTransform(1,0,0,1,0,0),w.clearRect(0,0,b.width,b.height),w.restore(),w.setTransform(1,0,0,1,0,0),window.data.particles.length>1&&window.data.constraints.rod.length+window.data.constraints.slider.length>1&&window.data.timestep>0&&typeof window.data.timestep=="number"){var[e,t,a]=ge();document.getElementById("range").innerText=t.toFixed(1);var n=0,o=0;e.forEach(r=>{for(;a[0][o+1]<n;)o+=1;n+=window.data.timestep,JSON.parse(a[1][o]);for(let l=0;l<window.data.constraints.rod.length;l++)if(window.data.constraints.rod[l].oneway!=!0){const c=window.data.constraints.rod[l],p=c.p1*2,d=c.p2*2;w.beginPath(),w.moveTo(r[p],r[p+1]),w.lineTo(r[d],r[d+1]),w.strokeStyle="rgba(255, 0, 0, 0.2)",w.stroke()}for(let l=0;l<window.data.constraints.rope.length;l++)if(window.data.constraints.rope[l].oneway!=!0){const c=window.data.constraints.rope[l],p=c.p1*2,d=c.p3*2;w.beginPath(),w.moveTo(r[p],r[p+1]);for(var i of window.data.constraints.rope[l].pulleys){var s=i.idx*2;w.lineTo(r[s],r[s+1])}w.lineTo(r[d],r[d+1]),w.strokeStyle="rgba(255, 0, 0, 0.2)",w.stroke()}}),w.strokeStyle="black"}w.lineWidth=3,window.data.constraints.rod.forEach(r=>{const i=window.data.particles[r.p1],s=window.data.particles[r.p2];w.beginPath(),w.moveTo(i.x,i.y),w.lineTo(s.x,s.y),w.strokeStyle=r.hovered?"yellow":"black",w.stroke()}),window.data.constraints.rope.forEach(r=>{const i=window.data.particles[r.p1],s=window.data.particles[r.p3];w.setLineDash([8,8]),w.beginPath(),w.moveTo(i.x,i.y);for(var l of r.pulleys){const c=window.data.particles[l.idx];w.lineTo(c.x,c.y)}w.lineTo(s.x,s.y),w.strokeStyle=r.hovered?"yellow":"black",w.stroke(),w.setLineDash([])}),window.data.constraints.slider.forEach(r=>{const i=window.data.particles[r.p],s=40,l=Math.atan2(r.normal.y,r.normal.x)+Math.PI/2;w.beginPath(),w.moveTo(i.x-s*Math.cos(l),i.y-s*Math.sin(l)),w.lineTo(i.x+s*Math.cos(l),i.y+s*Math.sin(l)),w.strokeStyle=r.hovered?"yellow":"black",w.stroke()}),window.data.constraints.colinear.concat(window.data.constraints.f2k).forEach(r=>{const i=window.data.particles[r.base],s=window.data.particles[r.reference],l=window.data.particles[r.slider],c=Math.sqrt((i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y)),p=(i.x-s.x)/c,d=(i.y-s.y)/c,f=Math.abs(p*(i.y-l.y)-d*(i.x-l.x));w.beginPath(),w.arc(l.x,l.y,f,0,Math.PI*2),w.strokeStyle="grey",w.stroke()}),w.lineWidth=1,window.data.particles.forEach((r,i)=>{const s=Math.cbrt(r.mass)*4;w.beginPath(),w.arc(r.x,r.y,s,0,Math.PI*2),w.fillStyle=r.hovered?"yellow":"black",w.strokeStyle="black",i==window.data.projectile&&(w.fillStyle="lightblue",w.strokeStyle="blue"),w.fill(),w.stroke(),w.font="18px Arial",w.textAlign="center",w.textBaseline="middle",w.fillStyle="black",w.fillText(`P${i+1}`,r.x,r.y-s-10)})}function at(){const e={x:100,y:100,mass:1,hovered:!1};window.data.particles.push(e),k()}function nt(e,t,a){window.data.particles[e][t]=Number(a),P()}function ot(e){window.data.particles.splice(e,1);for(var t in window.data.constraints)for(var a=window.data.constraints[t],n=!1;!n;){n=!0;for(var o=0;o<a.length;o++){var r=a[o],i=!1;for(var s of["p","p1","p2","p3","reference","base","slider"])r[s]===e&&(i=!0);i&&(n=!1,a.splice(o,1))}}for(var s of["projectile","armtip","mainaxle"])window.data[s]===e&&(window.data[s]=0);k()}function rt(e){let t={};if(e==="rod"){if(window.data.particles.length<2){alert("At least two particles are required to create a rod constraint.");return}var a=[];for(let r=window.data.particles.length-1;r>=0;r--)for(let i=window.data.particles.length-1;i>=0;i--)ie(r,i)||a.push([r,i]);t={p1:a[0][0],p2:a[0][1],hovered:!1},window.data.constraints.rod.push(t)}else if(e==="slider"){if(window.data.particles.length<1){alert("At least one particle is required to create a slider constraint.");return}var n=window.data.constraints.slider,o=window.data.particles.length-1;n.length>0&&n[n.length-1].p==o&&n[n.length-1].normal.x==0&&n[n.length-1].normal.y==1?t={p:o,normal:{x:1,y:0},hovered:!1}:t={p:o,normal:{x:0,y:1},hovered:!1},window.data.constraints.slider.push(t)}else if(e==="colinear")t={reference:0,slider:1,base:2},window.data.constraints.colinear.push(t);else if(e==="f2k")t={reference:0,slider:1,base:2},window.data.constraints.f2k.push(t);else if(e==="rope")t={p1:0,pulleys:[],p3:2},window.data.constraints.rope.push(t);else{console.error("Unknown constraint type:",e);return}k()}function it(e,t,a){const n=+e.value,o=window.data.constraints.rope[t];o.pulleys[a].idx=n,k()}function st(e,t,a){const n=e.value,o=window.data.constraints.rope[t];o.pulleys[a].wrapping=n,k()}function lt(e){window.data.constraints.rope[e].pulleys.pop(),k()}function ct(e){window.data.constraints.rope[e].pulleys.push({idx:0,wrapping:"both"}),k()}function dt(e,t,a,n){const o=n.includes("normal")?parseFloat(e.value):parseInt(e.value),r=window.data.constraints[t][a];n==="p1"||n==="p2"||n==="p"?(r[n]=o,k()):n==="normalX"||n==="normalY"?(r.normal[n.slice(-1).toLowerCase()]=o,P()):(r[n]=o,k())}function pt(e,t){window.data.constraints[e].splice(t,1),k()}function ue(){var e=window.innerWidth;e>1040&&(e-=440),e=Math.min(e,window.innerHeight-90),e=Math.max(e,400),b.width=600*1.9,b.height=600*1.9,b.style.width=e+"px",b.style.height=e+"px",window.innerWidth-e>840?document.getElementById("allcontrols").style.flexDirection="row":document.getElementById("allcontrols").style.flexDirection="column",k()}function k(){P(),document.getElementById("timestep").value=window.data.timestep,document.getElementById("duration").value=window.data.duration;const e=document.getElementById("particlesControl");for(;e.children.length>1;)e.removeChild(e.lastChild);window.data.particles.forEach((l,c)=>xe(c));const t=document.getElementById("constraintsControl");for(;t.children.length>5;)t.removeChild(t.lastChild);window.data.constraints.rod.forEach((l,c)=>U("rod",c)),window.data.constraints.slider.forEach((l,c)=>U("slider",c)),window.data.constraints.colinear.forEach((l,c)=>U("colinear",c)),window.data.constraints.f2k.forEach((l,c)=>U("f2k",c)),window.data.constraints.rope.forEach((l,c)=>U("rope",c));const a=document.getElementById("presets");for(;a.children.length>0;)a.removeChild(a.lastChild);const n=document.createElement("option");n.selected="true",n.innerHTML="Presets",a.appendChild(n);for(var o of Object.keys(ke)){const l=document.createElement("option");l.innerHTML=o,l.value=o,a.appendChild(l)}for(var r of["armtip","projectile","mainaxle"]){for(var i=document.getElementById(r);i.children.length>0;)i.removeChild(i.lastChild);for(var s=0;s<window.data.particles.length;s++){const l=document.createElement("option");l.selected=window.data[r]==s,l.innerHTML=`P ${s+1}`,l.value=s,i.appendChild(l)}}document.getElementById("axleheight").value=window.data.axleheight}function ce(e){window.data=JSON.parse(ke[e.value]),window.data.constraints.colinear===void 0&&(window.data.constraints.colinear=[]),window.data.constraints.f2k===void 0&&(window.data.constraints.f2k=[]),window.data.constraints.rope===void 0&&(window.data.constraints.rope=[]),k()}function xe(e){const t=document.createElement("div");t.className="control-box",t.innerHTML=`
                <label>Mass: <input type="text" min="1" max="500" value="${window.data.particles[e].mass}" oninput="updateParticle(${e}, 'mass', this.value)"></label>
                <label>X: <input type="text" min="0" max="${b.width}" value="${window.data.particles[e].x}" oninput="updateParticle(${e}, 'x', this.value)"></label>
                <label>Y: <input type="text" min="0" max="${b.height}" value="${window.data.particles[e].y}" oninput="updateParticle(${e}, 'y', this.value)"></label>
                ${e==data.particles.length-1?`<button class=delete onclick="deleteParticle(${e})">X</button>`:""}
              `,t.addEventListener("mouseenter",()=>{window.data.particles[e].hovered=!0,P()}),t.addEventListener("mouseleave",()=>{window.data.particles[e].hovered=!1,P()}),document.getElementById("particlesControl").appendChild(t)}function ie(e,t){if(e==t)return!0;for(var a of window.data.constraints.rod)if(a.p1==e&&a.p2==t||a.p1==t&&a.p2==e||e==t)return!0;return!1}function U(e,t){const a=document.createElement("div");if(a.className="control-box",a.dataset.type=e,a.dataset.index=t,e==="rod")a.innerHTML=`Rod
                    <select name="p1" onchange="updateConstraint(this, 'rod', ${t}, 'p1')">
            	   ${window.data.particles.map((n,o)=>o).filter(n=>!ie(window.data.constraints.rod[t].p2,n)||n==window.data.constraints.rod[t].p1).map(n=>`<option value="${n}" ${n===window.data.constraints.rod[t].p1?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
                    <select name="p2" onchange="updateConstraint(this, 'rod', ${t}, 'p2')">
            	   ${window.data.particles.map((n,o)=>o).filter(n=>!ie(window.data.constraints.rod[t].p1,n)||n==window.data.constraints.rod[t].p2).map(n=>`<option value="${n}" ${n===window.data.constraints.rod[t].p2?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    One way:
            			<input type="checkbox" oninput="window.data.constraints.rod[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rod[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('rod', ${t})">X</button>
                `;else if(e==="slider"){const n=window.data.constraints.slider[t];a.innerHTML=`
                  <label>
            		Slider
                    <select name="p" onchange="updateConstraint(this, 'slider', ${t}, 'p')">
                      ${window.data.particles.map((o,r)=>`<option value="${r}" ${r===n.p?"selected":""}>P ${r+1}</option>`).join("")}
                    </select>
                  </label>
                  <label>Normal X: <input type="range" name="normalX" min="-1" max="1" step="0.1" value="${n.normal.x}" oninput="updateConstraint(this, 'slider', ${t}, 'normalX')"></label>
                  <label>Normal Y: <input type="range" name="normalY" min="-1" max="1" step="0.1" value="${n.normal.y}" oninput="updateConstraint(this, 'slider', ${t}, 'normalY')"></label>
		  One way:
            			<input type="checkbox" oninput="window.data.constraints.slider[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.slider[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('slider', ${t})">X</button>
                `}else e==="colinear"?a.innerHTML=`Roller Track1
                    <select name="reference" onchange="updateConstraint(this, 'colinear', ${t}, 'reference')">
            	   ${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.colinear[t].reference?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    Slide
                    <select name="slider" onchange="updateConstraint(this, 'colinear', ${t}, 'slider')">

            	   ${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.colinear[t].slider?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    Track2
                    <select name="base" onchange="updateConstraint(this, 'colinear', ${t}, 'base')">

            	   ${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.colinear[t].base?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
            			<input type="checkbox" oninput="window.data.constraints.colinear[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.colinear[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('colinear', ${t})">X</button>
                `:e==="f2k"?a.innerHTML=`F2k Arm Tip
                    <select name="reference" onchange="updateConstraint(this, 'f2k', ${t}, 'reference')">
            	   ${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.f2k[t].reference?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    Roller 
                    <select name="slider" onchange="updateConstraint(this, 'f2k', ${t}, 'slider')">

            	   ${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.f2k[t].slider?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    Arm Base
                    <select name="base" onchange="updateConstraint(this, 'f2k', ${t}, 'base')">

            	   ${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.f2k[t].base?"selected":""}>P ${n+1}</option>`).join("")}
                    </select>
		    One way:
            			<input type="checkbox" oninput="window.data.constraints.f2k[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.f2k[t].oneway?"checked":""}></input>
                  <button class=delete onclick="deleteConstraint('f2k', ${t})">X</button>
                `:e==="rope"&&(a.innerHTML=`
				Rope and pulley.
				Fixed end:
				<select name="p1" onchange="updateConstraint(this, 'rope', ${t}, 'p1')">
								${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.rope[t].p1?"selected":""}>P ${n+1}</option>`).join("")}
				</select>
${window.data.constraints.rope[t].pulleys.map((n,o)=>`
Pulley:
<select name="p2" onchange="updatePulley(this, ${t}, ${o})">

${window.data.particles.map((r,i)=>i).map(r=>`<option value="${r}" ${r===n.idx?"selected":""}>P ${r+1}</option>`).join("")}
</select>
<select onchange="updatePulleyDirection(this, ${t}, ${o})">
${["both","cw","ccw","cw_drop","ccw_drop"].map(r=>`<option value=${r} ${r==n.wrapping?"selected":""}>${r}</option>`).join("")}
</select>
`).join("")}
<button onclick="addPulley(${t})">+</button>
<button onclick="removePulley(${t})">-</button>
Fixed end:
<select name="p3" onchange="updateConstraint(this, 'rope', ${t}, 'p3')">

${window.data.particles.map((n,o)=>o).map(n=>`<option value="${n}" ${n===window.data.constraints.rope[t].p3?"selected":""}>P ${n+1}</option>`).join("")}
</select>
<button class=delete onclick="deleteConstraint('rope', ${t})">X</button>
<input type="checkbox" oninput="window.data.constraints.rope[${t}].oneway=this.checked;updateUI()" ${window.data.constraints.rope[t].oneway?"checked":""}></input>
`);a.addEventListener("mouseenter",()=>{window.data.constraints[e][t].hovered=!0,P()}),a.addEventListener("mouseleave",()=>{window.data.constraints[e][t].hovered=!1,P()}),document.getElementById("constraintsControl").appendChild(a)}let N=null;function be(e,t){var a=window.data.particles.findIndex(n=>{const o=Math.sqrt((n.x-e)**2+(n.y-t)**2),r=Math.cbrt(n.mass)*10;return o<r});return a==-1&&(a=window.data.particles.findIndex(n=>{const o=Math.sqrt((n.x-e)**2+(n.y-t)**2),r=15+Math.cbrt(n.mass)*10;return o<r})),a}b.addEventListener("mousedown",function(e){const t=b.getBoundingClientRect(),a=b.width/t.width,n=b.height/t.height,o=(e.clientX-t.left)*a,r=(e.clientY-t.top)*n,i=be(o,r);i!==-1?(N=i,b.style.cursor="move"):(startX=e.clientX-b.offsetLeft,startY=e.clientY-b.offsetTop)});b.addEventListener("mousemove",function(e){if(N!==null){const t=b.getBoundingClientRect(),a=b.width/t.width,n=b.height/t.height,o=(e.clientX-t.left)*a,r=(e.clientY-t.top)*n;window.data.particles[N].x=o,window.data.particles[N].y=r,P()}});b.addEventListener("mouseup",function(e){N!==null&&(k(),N=null,b.style.cursor="default")});b.addEventListener("mouseleave",function(e){N!==null&&(k(),N=null,b.style.cursor="default")});function $e(){localStorage.setItem("mechanismData",JSON.stringify(window.data))}function _e(){const e=localStorage.getItem("mechanismData");if(e){window.data=JSON.parse(e);try{k()}catch{ce({value:"Hinged Counterweight"})}}else ce({value:"Hinged Counterweight"})}window.addEventListener("resize",ue);window.onload=()=>{_e(),ue(),fetch("https://apj.hgreer.com/jstreb",{method:"GET",cache:"no-store",mode:"no-cors"})};var ke={"Hinged Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":588,"y":440.7,"mass":10},{"x":668,"y":673.6,"mass":1},{"x":586,"y":533.7,"mass":100}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Fixed Counterweight":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":536,"y":472.7,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":668,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Floating Arm Trebuchet":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3, "duration":35, "particles":[{"x":487.0,"y":517.0,"mass":1},{"x":346,"y":657.6,"mass":4},{"x":589,"y":444.7,"mass":100},{"x":589,"y":673.6,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',F2k:'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.6,"duration":35,"particles":[{"x":454,"y":516,"mass":1},{"x":436.6,"y":513.0,"mass":4},{"x":560.3,"y":211.5,"mass":100},{"x":652.9,"y":621.8,"mass":1}],"constraints":{"rod":[{"p1":1,"p2":3},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":1,"y":1}},{"p":2,"normal":{"x":0.6,"y":0}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":0,"normal":{"x":0,"y":1}}],"colinear":[],"f2k":[{"reference":1,"slider":0,"base":2}],"rope":[]}}',"Floating Arm Whipper (NASAW)":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":37,"particles":[{"x":496.3,"y":477.6,"mass":1},{"x":677.5,"y":471.0,"mass":4},{"x":468.0,"y":453.5,"mass":10},{"x":557.0,"y":431.8,"mass":1},{"x":563.0,"y":340.7,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":4,"normal":{"x":0.6,"y":0}}],"colinear":[]}}',Whipper:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.3,"duration":60,"particles":[{"x":536,"y":472.7,"mass":1},{"x":759,"y":451,"mass":4},{"x":483,"y":498,"mass":10},{"x":551,"y":434,"mass":1},{"x":560,"y":368,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":3,"oneway":true},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":0}}]}}',Fiffer:'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":20,"particles":[{"x":536,"y":472.7,"mass":1},{"x":484,"y":656,"mass":4},{"x":504,"y":433,"mass":10},{"x":644,"y":661,"mass":1},{"x":653,"y":451,"mass":10},{"x":749,"y":428,"mass":1},{"x":749,"y":483,"mass":500},{"x":566,"y":505,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":7,"p2":6},{"p1":6,"p2":4},{"p1":4,"p2":5}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":7,"normal":{"x":0.7,"y":1}},{"p":7,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0,"y":1}},{"p":5,"normal":{"x":0.7,"y":1}}]}}',"Floating Arm King Arthur":'{"projectile":3, "mainaxle":0, "armtip":1, "axleheight":8, "timestep":0.2,"duration":40,"particles":[{"x":536,"y":472.7,"mass":1},{"x":527,"y":610,"mass":4},{"x":534,"y":418,"mass":10},{"x":698,"y":608,"mass":1},{"x":560,"y":331,"mass":200}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":1,"p2":3},{"p1":2,"p2":4},{"p1":1,"p2":2}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":2,"normal":{"x":-0.5,"y":0},"oneway":true},{"p":1,"normal":{"x":0.7,"y":0},"oneway":true},{"p":3,"normal":{"x":0,"y":1},"oneway":true}]}}',"Launch Ness Monster":'{"projectile":3,"mainaxle":2,"armtip":1,"axleheight":8,"timestep":0.3,"duration":80,"particles":[{"x":600.7,"y":746.2,"mass":10},{"x":559.1,"y":774.0,"mass":4},{"x":660.2,"y":530.0,"mass":100},{"x":703.9,"y":796.7,"mass":1},{"x":810,"y":530,"mass":10},{"x":552,"y":500,"mass":10},{"x":458,"y":666,"mass":10},{"x":886.1,"y":662.4,"mass":10}],"constraints":{"rod":[{"p1":2,"p2":1},{"p1":3,"p2":1},{"p1":6,"p2":5},{"p1":5,"p2":2},{"p1":4,"p2":2},{"p1":4,"p2":7},{"p1":5,"p2":4}],"slider":[{"p":0,"normal":{"x":1,"y":2.1}},{"p":0,"normal":{"x":-0.6,"y":1.6}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":6,"normal":{"x":0.6,"y":1}},{"p":6,"normal":{"x":0,"y":1}},{"p":7,"normal":{"x":1,"y":1}},{"p":7,"normal":{"x":0,"y":1}}],"colinear":[{"reference":1,"slider":0,"base":2}]}}',"Pulley Sling":'{"projectile":3,"mainaxle":0,"armtip":1,"axleheight":8,"timestep":0.2,"duration":35,"particles":[{"x":546.3,"y":584.3,"mass":1},{"x":285.6,"y":791.6,"mass":4},{"x":560.6,"y":481.2,"mass":10},{"x":1000.9,"y":742.8,"mass":1},{"x":645.5,"y":541.0,"mass":500},{"x":72.7,"y":730.2,"mass":1}],"constraints":{"rod":[{"p1":0,"p2":1},{"p1":0,"p2":2},{"p1":2,"p2":4},{"p1":1,"p2":2},{"p1":0,"p2":4,"oneway":true}],"slider":[{"p":0,"normal":{"x":0,"y":1}},{"p":0,"normal":{"x":0.6,"y":1}},{"p":3,"normal":{"x":0,"y":1},"oneway":true},{"p":5,"normal":{"x":1,"y":1}},{"p":5,"normal":{"x":0,"y":1}}],"colinear":[],"rope":[{"p1":5,"pulleys":[{"idx":1,"wrapping":"both"}],"p3":3}]}}'};let re=!1;async function wt(){if(re){re=!1,document.getElementById("optimize").innerText="Optimize";return}document.getElementById("optimize").innerText="Stop",re=!0;for(var e=500,t=e,a=40;re;){var n=+document.getElementById("range").innerText,o=JSON.stringify(window.data);for(var r of window.data.particles)Math.random()>.5&&(r.x=r.x+a*(.5-Math.random()),r.y=r.y+a*(.5-Math.random()));var[i,s]=ge();t%20==0&&await Ze();var l=s;l>n?(t=e,P()):(window.data=JSON.parse(o),t-=1,t==0&&(t=e,a*=.6))}P()}function ut(){const e=new Blob([JSON.stringify(window.data)],{type:"application/json"}),t=prompt("Enter a filename for your window.data:","window.data.json");if(!t){alert("Save cancelled.");return}const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}function ft(){const e=document.createElement("input");e.type="file",e.onchange=t=>{const a=t.target.files[0],n=new FileReader;n.onload=o=>{try{window.data=JSON.parse(o.target.result),k()}catch{alert("Error parsing JSON!")}},n.readAsText(a)},document.body.appendChild(e),e.click(),document.body.removeChild(e)}window.doAnimate=tt;window.terminate=we;window.drawMechanism=P;window.createParticle=at;window.updateParticle=nt;window.deleteParticle=ot;window.createConstraint=rt;window.updateConstraint=dt;window.deleteConstraint=pt;window.resizeCanvas=ue;window.updateUI=k;window.loadPreset=ce;window.createParticleControlBox=xe;window.constraintExists=ie;window.createConstraintControlBox=U;window.getParticleAtPosition=be;window.saveMechanism=$e;window.loadMechanism=_e;window.optimize=wt;window.save=ut;window.load=ft;window.updatePulley=it;window.updatePulleyDirection=st;window.addPulley=ct;window.removePulley=lt;
